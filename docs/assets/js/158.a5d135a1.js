(window.webpackJsonp=window.webpackJsonp||[]).push([[158],{595:function(t,s,a){"use strict";a.r(s);var n=a(36),r=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"ðŸš€-azure-resources"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ðŸš€-azure-resources"}},[t._v("#")]),t._v(" ðŸš€ Azure Resources")]),t._v(" "),a("p",[t._v("This is a list of all the resources, both mandatory and optional, used to deploy a full-featured SalesTim environment on Azure.")]),t._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("N.B")]),t._v(" "),a("p",[t._v("This documentation is automatically generated from our sample "),a("a",{attrs:{href:"https://www.terraform.io/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Terraform"),a("OutboundLink")],1),t._v(" configuration file, and is intended to be used as a reference.\nYou'll have to edit the variables and configuration files to specify the appropriate settings for your environment and resources.")])]),t._v(" "),a("p",[a("strong",[t._v("TABLE OF CONTENTS")])]),t._v(" "),a("p"),a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#terraform-deployment-provider"}},[t._v("Terraform deployment provider")])]),a("li",[a("a",{attrs:{href:"#core-components"}},[t._v("Core components")]),a("ul",[a("li",[a("a",{attrs:{href:"#azure-resource-group"}},[t._v("Azure resource group")])]),a("li",[a("a",{attrs:{href:"#azure-cache-for-redis"}},[t._v("Azure cache for Redis")])]),a("li",[a("a",{attrs:{href:"#azure-database-for-postgresql"}},[t._v("Azure Database for PostgreSQL")])]),a("li",[a("a",{attrs:{href:"#azure-storage-account"}},[t._v("Azure Storage Account")])]),a("li",[a("a",{attrs:{href:"#azure-cosmos-db"}},[t._v("Azure Cosmos DB")])]),a("li",[a("a",{attrs:{href:"#azure-app-service-plans"}},[t._v("Azure App Service Plans")])]),a("li",[a("a",{attrs:{href:"#azure-app-services"}},[t._v("Azure App Services")])]),a("li",[a("a",{attrs:{href:"#azure-front-door"}},[t._v("Azure Front Door")])])])]),a("li",[a("a",{attrs:{href:"#monitoring-components"}},[t._v("Monitoring components")]),a("ul",[a("li",[a("a",{attrs:{href:"#azure-monitoring-app-service-plan"}},[t._v("Azure Monitoring App Service Plan")])]),a("li",[a("a",{attrs:{href:"#events-collector-app-service"}},[t._v("Events Collector App Service")])]),a("li",[a("a",{attrs:{href:"#azure-application-insights"}},[t._v("Azure Application Insights")])]),a("li",[a("a",{attrs:{href:"#prometheus-app-service"}},[t._v("Prometheus App Service")])]),a("li",[a("a",{attrs:{href:"#redis-prometheus-exporter-app-service"}},[t._v("Redis Prometheus Exporter App Service")])]),a("li",[a("a",{attrs:{href:"#bull-prometheus-exporter-app-service"}},[t._v("Bull Prometheus Exporter App Service")])])])])])]),a("p"),t._v(" "),a("hr"),t._v(" "),a("h2",{attrs:{id:"terraform-deployment-provider"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#terraform-deployment-provider"}},[t._v("#")]),t._v(" Terraform deployment provider")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("Tip")]),t._v(" "),a("p",[t._v("In this example we're using the "),a("a",{attrs:{href:"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs",target:"_blank",rel:"noopener noreferrer"}},[t._v("Terraform provider for Azure"),a("OutboundLink")],1),t._v(".\nA similar configuration can be used for any other provider, such as "),a("a",{attrs:{href:"https://registry.terraform.io/providers/kreuzwerker/docker/latest/docs",target:"_blank",rel:"noopener noreferrer"}},[t._v("Docker provider"),a("OutboundLink")],1),t._v(" for Terraform.")])]),t._v(" "),a("div",{staticClass:"language-hcl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-hcl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Register the Terraform provider for Microsoft Azure by defining its source and version being used")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("terraform")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("required_providers")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("azurerm")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("source")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hashicorp/azurerm"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("version")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2.58.0"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Configure the Terraform provider for Microsoft Azure with its subscription ID")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("provider"),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v(' "azurerm" ')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("features")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("subscription_id")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.subscription_id\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"core-components"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#core-components"}},[t._v("#")]),t._v(" Core components")]),t._v(" "),a("h3",{attrs:{id:"azure-resource-group"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#azure-resource-group"}},[t._v("#")]),t._v(" Azure resource group")]),t._v(" "),a("div",{staticClass:"language-hcl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-hcl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_resource_group"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"rg"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-rg"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("location")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.resource_group.location\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tags")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("product")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.product.name,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("environment")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.environment,\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("div",{staticClass:"language-hcl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-hcl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_resource_group"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"rg"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-rg"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("location")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.resource_group.location\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tags")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("product")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.product.name,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("environment")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.environment,\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("In this configuration, all the Azure resources will be created in a single resource group."),a("br"),t._v(" "),a("a",{attrs:{href:"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/resource_group",target:"_blank",rel:"noopener noreferrer"}},[t._v("Learn more..."),a("OutboundLink")],1)]),t._v(" "),a("div",{staticClass:"language-hcl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-hcl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_resource_group"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"rg"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-rg"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("location")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.resource_group.location\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tags")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("product")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.product.name,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("environment")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.environment,\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"azure-cache-for-redis"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#azure-cache-for-redis"}},[t._v("#")]),t._v(" Azure cache for Redis")]),t._v(" "),a("div",{staticClass:"language-hcl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-hcl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create the Redis service")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_redis_cache"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redis"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-redis"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("location")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.location\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("resource_group_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.name\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tags")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("product")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.product.name,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("environment")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.environment,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tier")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"backing-services"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# The size of the Redis cache to deploy. Valid values for a SKU family of C (Basic/Standard) are 0, 1, 2, 3, 4, 5, 6, and for P (Premium) family are 1, 2, 3, 4.")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("capacity")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# The SKU family/pricing group to use. Valid values are C (for Basic/Standard SKU family) and P (for Premium)")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("family")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"C"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# The SKU of Redis to use. Possible values are Basic, Standard and Premium")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("sku_name")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Standard"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("enable_non_ssl_port")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("minimum_tls_version")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1.2"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("redis_configuration")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("aof_backup_enabled")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("enable_authentication")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("patch_schedule")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("day_of_week")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Sunday"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# N.B: The Patch Window lasts for 5 hours from the start_hour_utc.")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("start_hour_utc")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"02"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("div",{staticClass:"language-hcl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-hcl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create the Redis service")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_redis_cache"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redis"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-redis"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("location")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.location\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("resource_group_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.name\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tags")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("product")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.product.name,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("environment")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.environment,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tier")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"backing-services"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# The size of the Redis cache to deploy. Valid values for a SKU family of C (Basic/Standard) are 0, 1, 2, 3, 4, 5, 6, and for P (Premium) family are 1, 2, 3, 4.")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("capacity")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# The SKU family/pricing group to use. Valid values are C (for Basic/Standard SKU family) and P (for Premium)")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("family")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"C"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# The SKU of Redis to use. Possible values are Basic, Standard and Premium")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("sku_name")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Standard"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("enable_non_ssl_port")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("minimum_tls_version")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1.2"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("redis_configuration")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("aof_backup_enabled")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("enable_authentication")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("patch_schedule")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("day_of_week")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Sunday"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# N.B: The Patch Window lasts for 5 hours from the start_hour_utc.")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("start_hour_utc")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"02"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[a("a",{attrs:{href:"https://redis.io",target:"_blank",rel:"noopener noreferrer"}},[t._v("Redis"),a("OutboundLink")],1),t._v(" is used for all the caching and queuing mechanisms in the platform."),a("br"),t._v("\nThe following configuration creates an Azure managed Redis instance."),a("br"),t._v(" "),a("a",{attrs:{href:"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/redis_cache",target:"_blank",rel:"noopener noreferrer"}},[t._v("Learn more..."),a("OutboundLink")],1)]),t._v(" "),a("div",{staticClass:"language-hcl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-hcl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create the Redis service")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_redis_cache"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redis"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-redis"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("location")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.location\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("resource_group_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.name\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tags")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("product")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.product.name,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("environment")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.environment,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tier")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"backing-services"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# The size of the Redis cache to deploy. Valid values for a SKU family of C (Basic/Standard) are 0, 1, 2, 3, 4, 5, 6, and for P (Premium) family are 1, 2, 3, 4.")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("capacity")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# The SKU family/pricing group to use. Valid values are C (for Basic/Standard SKU family) and P (for Premium)")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("family")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"C"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# The SKU of Redis to use. Possible values are Basic, Standard and Premium")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("sku_name")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Standard"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("enable_non_ssl_port")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("minimum_tls_version")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1.2"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("redis_configuration")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("aof_backup_enabled")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("enable_authentication")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("patch_schedule")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("day_of_week")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Sunday"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# N.B: The Patch Window lasts for 5 hours from the start_hour_utc.")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("start_hour_utc")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"02"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"azure-database-for-postgresql"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#azure-database-for-postgresql"}},[t._v("#")]),t._v(" Azure Database for PostgreSQL")]),t._v(" "),a("div",{staticClass:"language-hcl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-hcl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create the PostgreSQL service")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_postgresql_server"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"postgres"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-postgres"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("location")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.location\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("resource_group_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.name\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tags")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("product")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.product.name,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("environment")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.environment,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tier")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"backing-services"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("sku_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"B_Gen5_2"')]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("storage_mb")]),t._v("                   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5120")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("backup_retention_days")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("geo_redundant_backup_enabled")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("auto_grow_enabled")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("version")]),t._v("                          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"11"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("ssl_enforcement_enabled")]),t._v("          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("ssl_minimal_tls_version_enforced")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"TLS1_2"')]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("administrator_login")]),t._v("           "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.postgres.db_username\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("administrator_login_password")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.postgres.db_password\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("public_network_access_enabled")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create firewall rules for the PostgreSQL service")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# See: https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/postgresql_firewall_rule")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_postgresql_firewall_rule"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"postgres_firewall_rule"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-postgres-allowazure-firewall-rule"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("resource_group_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.name\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("server_name")]),t._v("         "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_server.postgres.name\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# The Azure feature Allow access to Azure services can be enabled by setting start_ip_address and end_ip_address to 0.0.0.0")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("start_ip_address")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0.0.0.0"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("end_ip_address")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0.0.0.0"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create the configuration database")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_postgresql_database"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"config_db"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-config-database"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("resource_group_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.name\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("server_name")]),t._v("         "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_server.postgres.name\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("charset")]),t._v("             "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"UTF8"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("collation")]),t._v("           "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"English_United States.1252"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("div",{staticClass:"language-hcl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-hcl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create the PostgreSQL service")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_postgresql_server"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"postgres"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-postgres"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("location")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.location\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("resource_group_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.name\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tags")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("product")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.product.name,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("environment")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.environment,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tier")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"backing-services"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("sku_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"B_Gen5_2"')]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("storage_mb")]),t._v("                   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5120")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("backup_retention_days")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("geo_redundant_backup_enabled")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("auto_grow_enabled")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("version")]),t._v("                          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"11"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("ssl_enforcement_enabled")]),t._v("          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("ssl_minimal_tls_version_enforced")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"TLS1_2"')]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("administrator_login")]),t._v("           "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.postgres.db_username\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("administrator_login_password")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.postgres.db_password\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("public_network_access_enabled")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create firewall rules for the PostgreSQL service")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# See: https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/postgresql_firewall_rule")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_postgresql_firewall_rule"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"postgres_firewall_rule"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-postgres-allowazure-firewall-rule"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("resource_group_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.name\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("server_name")]),t._v("         "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_server.postgres.name\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# The Azure feature Allow access to Azure services can be enabled by setting start_ip_address and end_ip_address to 0.0.0.0")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("start_ip_address")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0.0.0.0"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("end_ip_address")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0.0.0.0"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create the configuration database")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_postgresql_database"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"config_db"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-config-database"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("resource_group_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.name\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("server_name")]),t._v("         "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_server.postgres.name\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("charset")]),t._v("             "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"UTF8"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("collation")]),t._v("           "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"English_United States.1252"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[a("a",{attrs:{href:"https://www.postgresql.org",target:"_blank",rel:"noopener noreferrer"}},[t._v("PostgreSQL"),a("OutboundLink")],1),t._v(" is used for storing the application configuration (templates, policies, settings...), and as an option, to store the application audit trails."),a("br"),t._v("\nThe following configuration creates an Azure-managed PostgreSQL service, and provisions the configuration database."),a("br"),t._v(" "),a("a",{attrs:{href:"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/postgresql_database",target:"_blank",rel:"noopener noreferrer"}},[t._v("Learn more..."),a("OutboundLink")],1)]),t._v(" "),a("div",{staticClass:"language-hcl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-hcl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create the PostgreSQL service")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_postgresql_server"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"postgres"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-postgres"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("location")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.location\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("resource_group_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.name\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tags")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("product")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.product.name,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("environment")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.environment,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tier")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"backing-services"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("sku_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"B_Gen5_2"')]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("storage_mb")]),t._v("                   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5120")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("backup_retention_days")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("geo_redundant_backup_enabled")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("auto_grow_enabled")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("version")]),t._v("                          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"11"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("ssl_enforcement_enabled")]),t._v("          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("ssl_minimal_tls_version_enforced")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"TLS1_2"')]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("administrator_login")]),t._v("           "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.postgres.db_username\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("administrator_login_password")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.postgres.db_password\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("public_network_access_enabled")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create firewall rules for the PostgreSQL service")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# See: https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/postgresql_firewall_rule")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_postgresql_firewall_rule"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"postgres_firewall_rule"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-postgres-allowazure-firewall-rule"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("resource_group_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.name\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("server_name")]),t._v("         "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_server.postgres.name\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# The Azure feature Allow access to Azure services can be enabled by setting start_ip_address and end_ip_address to 0.0.0.0")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("start_ip_address")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0.0.0.0"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("end_ip_address")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0.0.0.0"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create the configuration database")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_postgresql_database"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"config_db"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-config-database"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("resource_group_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.name\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("server_name")]),t._v("         "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_server.postgres.name\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("charset")]),t._v("             "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"UTF8"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("collation")]),t._v("           "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"English_United States.1252"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"azure-storage-account"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#azure-storage-account"}},[t._v("#")]),t._v(" Azure Storage Account")]),t._v(" "),a("div",{staticClass:"language-hcl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-hcl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create an Azure Storage Account")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_storage_account"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"azure_storage"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('sa"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("location")]),t._v("                 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.location\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("resource_group_name")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.name\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("account_tier")]),t._v("             "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Standard"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("account_replication_type")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"LRS"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("min_tls_version")]),t._v("          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"TLS1_2"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tags")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("product")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.product.name,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("environment")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.environment,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tier")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"backing-services"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("div",{staticClass:"language-hcl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-hcl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create an Azure Storage Account")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_storage_account"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"azure_storage"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('sa"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("location")]),t._v("                 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.location\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("resource_group_name")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.name\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("account_tier")]),t._v("             "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Standard"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("account_replication_type")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"LRS"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("min_tls_version")]),t._v("          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"TLS1_2"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tags")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("product")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.product.name,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("environment")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.environment,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tier")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"backing-services"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("Azure Storage is used for storing application-generated blobs, such as the templates pictures."),a("br"),t._v("\nThe following configuration creates an Azure Storage Account."),a("br"),t._v(" "),a("a",{attrs:{href:"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/storage_account",target:"_blank",rel:"noopener noreferrer"}},[t._v("Learn more..."),a("OutboundLink")],1)]),t._v(" "),a("div",{staticClass:"language-hcl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-hcl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create an Azure Storage Account")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_storage_account"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"azure_storage"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('sa"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("location")]),t._v("                 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.location\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("resource_group_name")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.name\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("account_tier")]),t._v("             "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Standard"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("account_replication_type")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"LRS"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("min_tls_version")]),t._v("          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"TLS1_2"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tags")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("product")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.product.name,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("environment")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.environment,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tier")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"backing-services"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"azure-cosmos-db"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#azure-cosmos-db"}},[t._v("#")]),t._v(" Azure Cosmos DB")]),t._v(" "),a("div",{staticClass:"language-hcl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-hcl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create an Azure Cosmos DB Account")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_cosmosdb_account"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"cosmosdb"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-cosmosdb"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("location")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.location\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("resource_group_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.name\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tags")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("product")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.product.name,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("environment")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.environment,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tier")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"backing-services"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("offer_type")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Standard"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("kind")]),t._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"GlobalDocumentDB"')]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("consistency_policy")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("consistency_level")]),t._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"BoundedStaleness"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("max_interval_in_seconds")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("400")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Must be > 300 when failover is enabled")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("max_staleness_prefix")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("200000")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Must be > 100000 when failover is enabled")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("enable_automatic_failover")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 0 sets the default location")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("geo_location")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("location")]),t._v("          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.location\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("failover_priority")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("geo_location")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("location")]),t._v("          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.cosmosdb.replication_location\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("failover_priority")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("public_network_access_enabled")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("ip_range_filter")]),t._v("               "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0.0.0.0"')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("div",{staticClass:"language-hcl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-hcl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create an Azure Cosmos DB Account")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_cosmosdb_account"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"cosmosdb"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-cosmosdb"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("location")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.location\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("resource_group_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.name\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tags")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("product")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.product.name,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("environment")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.environment,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tier")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"backing-services"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("offer_type")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Standard"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("kind")]),t._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"GlobalDocumentDB"')]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("consistency_policy")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("consistency_level")]),t._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"BoundedStaleness"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("max_interval_in_seconds")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("400")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Must be > 300 when failover is enabled")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("max_staleness_prefix")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("200000")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Must be > 100000 when failover is enabled")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("enable_automatic_failover")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 0 sets the default location")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("geo_location")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("location")]),t._v("          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.location\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("failover_priority")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("geo_location")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("location")]),t._v("          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.cosmosdb.replication_location\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("failover_priority")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("public_network_access_enabled")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("ip_range_filter")]),t._v("               "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0.0.0.0"')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("Azure CosmosDB is used for storing application-generated objects, such as templates advanced configurations and policies."),a("br"),t._v("\nThe following configuration creates an Azure Cosmos DB account."),a("br"),t._v(" "),a("a",{attrs:{href:"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/cosmosdb_account",target:"_blank",rel:"noopener noreferrer"}},[t._v("Learn more..."),a("OutboundLink")],1)]),t._v(" "),a("div",{staticClass:"language-hcl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-hcl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create an Azure Cosmos DB Account")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_cosmosdb_account"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"cosmosdb"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-cosmosdb"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("location")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.location\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("resource_group_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.name\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tags")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("product")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.product.name,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("environment")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.environment,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tier")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"backing-services"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("offer_type")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Standard"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("kind")]),t._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"GlobalDocumentDB"')]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("consistency_policy")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("consistency_level")]),t._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"BoundedStaleness"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("max_interval_in_seconds")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("400")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Must be > 300 when failover is enabled")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("max_staleness_prefix")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("200000")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Must be > 100000 when failover is enabled")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("enable_automatic_failover")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 0 sets the default location")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("geo_location")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("location")]),t._v("          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.location\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("failover_priority")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("geo_location")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("location")]),t._v("          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.cosmosdb.replication_location\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("failover_priority")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("public_network_access_enabled")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("ip_range_filter")]),t._v("               "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0.0.0.0"')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"azure-app-service-plans"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#azure-app-service-plans"}},[t._v("#")]),t._v(" Azure App Service Plans")]),t._v(" "),a("div",{staticClass:"language-hcl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-hcl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create an Azure App Service Plan for the `web` tier")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_app_service_plan"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"web"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-web-asp"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("location")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.location\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("resource_group_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.name\n\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tags")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("product")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.product.name,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("environment")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.environment,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tier")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"web"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("kind")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Linux"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("reserved")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("sku")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tier")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Premium"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("size")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"P2V2"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create an Azure App Service Plan for the `api` tier")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_app_service_plan"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"api"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-api-asp"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("location")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.location\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("resource_group_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.name\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tags")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("product")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.product.name,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("environment")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.environment,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tier")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"api"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("kind")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Linux"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("reserved")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("sku")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tier")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Premium"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("size")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"P2V2"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create an Azure App Service Plan for the `jobs` tier")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_app_service_plan"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"jobs"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-jobs-asp"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("location")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.location\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("resource_group_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.name\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tags")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("product")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.product.name,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("environment")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.environment,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tier")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"jobs"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("kind")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Linux"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("reserved")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("sku")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tier")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Premium"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("size")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"P2V2"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("div",{staticClass:"language-hcl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-hcl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create an Azure App Service Plan for the `web` tier")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_app_service_plan"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"web"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-web-asp"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("location")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.location\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("resource_group_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.name\n\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tags")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("product")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.product.name,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("environment")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.environment,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tier")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"web"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("kind")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Linux"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("reserved")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("sku")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tier")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Premium"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("size")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"P2V2"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create an Azure App Service Plan for the `api` tier")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_app_service_plan"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"api"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-api-asp"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("location")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.location\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("resource_group_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.name\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tags")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("product")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.product.name,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("environment")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.environment,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tier")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"api"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("kind")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Linux"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("reserved")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("sku")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tier")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Premium"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("size")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"P2V2"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create an Azure App Service Plan for the `jobs` tier")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_app_service_plan"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"jobs"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-jobs-asp"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("location")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.location\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("resource_group_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.name\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tags")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("product")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.product.name,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("environment")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.environment,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tier")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"jobs"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("kind")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Linux"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("reserved")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("sku")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tier")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Premium"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("size")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"P2V2"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("The following configuration create an Azure App Service Plan for each tier, "),a("code",[t._v("web")]),t._v(", "),a("code",[t._v("api")]),t._v(" and "),a("code",[t._v("jobs")]),t._v("."),a("br"),t._v(" "),a("a",{attrs:{href:"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/app_service_plan",target:"_blank",rel:"noopener noreferrer"}},[t._v("Learn more..."),a("OutboundLink")],1)]),t._v(" "),a("div",{staticClass:"language-hcl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-hcl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create an Azure App Service Plan for the `web` tier")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_app_service_plan"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"web"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-web-asp"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("location")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.location\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("resource_group_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.name\n\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tags")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("product")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.product.name,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("environment")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.environment,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tier")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"web"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("kind")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Linux"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("reserved")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("sku")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tier")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Premium"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("size")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"P2V2"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create an Azure App Service Plan for the `api` tier")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_app_service_plan"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"api"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-api-asp"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("location")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.location\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("resource_group_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.name\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tags")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("product")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.product.name,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("environment")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.environment,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tier")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"api"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("kind")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Linux"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("reserved")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("sku")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tier")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Premium"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("size")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"P2V2"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create an Azure App Service Plan for the `jobs` tier")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_app_service_plan"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"jobs"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-jobs-asp"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("location")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.location\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("resource_group_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.name\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tags")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("product")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.product.name,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("environment")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.environment,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tier")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"jobs"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("kind")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Linux"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("reserved")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("sku")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tier")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Premium"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("size")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"P2V2"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"azure-app-services"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#azure-app-services"}},[t._v("#")]),t._v(" Azure App Services")]),t._v(" "),a("div",{staticClass:"language-hcl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-hcl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create multiple Azure App Services for the `web` tier")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_app_service"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"web_tier"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-web-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("count")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("index")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-appservice"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("location")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.location\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("resource_group_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.name\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("app_service_plan_id")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_app_service_plan.web.id\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("count")]),t._v("               "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.scaling_factors.web\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tags")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("product")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.product.name,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("environment")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.environment,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tier")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"web"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("enabled")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("https_only")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("site_config")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("linux_fx_version")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.site_config.linux_fx_version\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("min_tls_version")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.site_config.min_tls_version\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("app_command_line")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.site_config.app_command_line\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("always_on")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.site_config.always_on\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("app_settings")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"WEBSITES_ENABLE_APP_SERVICE_STORAGE"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"false"')]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DOCKER_ENABLE_CI"')]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DOCKER_REGISTRY_SERVER_URL"')]),t._v("      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.container_registry.url\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DOCKER_REGISTRY_SERVER_USERNAME"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.container_registry.username\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DOCKER_REGISTRY_SERVER_PASSWORD"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.container_registry.password\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"APP_ROLE"')]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"web"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DEPLOY"')]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"self"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"LOG_LEVEL"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"debug"')]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"WEB_PUBLICURL"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://web-'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("."),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("domain"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"API_PUBLICURL"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://api-'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("."),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("domain"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('/api/v1.0"')]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APP_CLIENT_ID"')]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("microsoft_appreg")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("client_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APP_CLIENT_SECRET"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("microsoft_appreg")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("client_secret"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_HOST"')]),t._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_redis_cache.redis.hostname\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_PORT"')]),t._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_redis_cache.redis.ssl_port\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_DB"')]),t._v("         "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_TLS"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_SECRET_KEY"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_redis_cache.redis.primary_access_key\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_DATA_HOST"')]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_server.postgres.fqdn\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_DATA_DIALECT_OPTIONS"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"{\\"ssl\\": true}"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_DATA_DATABASE_NAME"')]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_database.config_db.name\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_DATA_USERNAME"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_postgresql_server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("postgres"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("administrator_login"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("@"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_postgresql_server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("postgres"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# "${var.postgres.db_username}@${azurerm_postgresql_server.postgres.name}"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_DATA_PASSWORD"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_server.postgres.administrator_login_password                                        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# var.postgres.db_password")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_EVENTS_HOST"')]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_server.postgres.fqdn\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_EVENTS_DIALECT_OPTIONS"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"{\\"ssl\\": true}"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_EVENTS_DATABASE_NAME"')]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_database.audit_db.name\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_EVENTS_USERNAME"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_postgresql_server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("postgres"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("administrator_login"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("@"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_postgresql_server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("postgres"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_EVENTS_PASSWORD"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_server.postgres.administrator_login_password "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# var.postgres.db_password")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_AZURE_STORAGE_ACCOUNT_NAME"')]),t._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_storage_account.azure_storage.name\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_AZURE_STORAGE_ACCOUNT_SECRET_KEY"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_storage_account.azure_storage.primary_access_key\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_AZURE_STORAGE_ENDPOINT"')]),t._v("           "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_storage_account.azure_storage.primary_blob_endpoint\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_COSMOSDB_ENDPOINT"')]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_cosmosdb_account.cosmosdb.endpoint\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_COSMOSDB_SECRET_KEY"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_cosmosdb_account.cosmosdb.primary_key\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APPINSIGHTS_INTEGRATION_ENABLED"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APPINSIGHTS_LIVE_METRICS_ENABLED"')]),t._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APPINSIGHTS_INSTRUMENTATION_SECRET_KEY"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_application_insights.app_insights.instrumentation_key\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APPINSIGHTS_CONNECTION_STRING"')]),t._v("          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_application_insights.app_insights.connection_string\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create multiple Azure App Services for the `api` tier")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_app_service"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"api_tier"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-api-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("count")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("index")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-appservice"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("location")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.location\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("resource_group_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.name\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("app_service_plan_id")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_app_service_plan.api.id\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("count")]),t._v("               "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.scaling_factors.api\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tags")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("product")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.product.name,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("environment")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.environment,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tier")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"api"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("enabled")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("https_only")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("site_config")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("linux_fx_version")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.site_config.linux_fx_version\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("min_tls_version")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.site_config.min_tls_version\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("app_command_line")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.site_config.app_command_line\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("always_on")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.site_config.always_on\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("app_settings")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"WEBSITES_ENABLE_APP_SERVICE_STORAGE"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"false"')]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DOCKER_ENABLE_CI"')]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DOCKER_REGISTRY_SERVER_URL"')]),t._v("      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.container_registry.url\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DOCKER_REGISTRY_SERVER_USERNAME"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.container_registry.username\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DOCKER_REGISTRY_SERVER_PASSWORD"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.container_registry.password\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"APP_ROLE"')]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"api"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DEPLOY"')]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"self"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"LOG_LEVEL"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"debug"')]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"WEB_PUBLICURL"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://web-'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("."),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("domain"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"API_PUBLICURL"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://api-'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("."),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("domain"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('/api/v1.0"')]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APP_CLIENT_ID"')]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("microsoft_appreg")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("client_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APP_CLIENT_SECRET"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("microsoft_appreg")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("client_secret"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_HOST"')]),t._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_redis_cache.redis.hostname\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_PORT"')]),t._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_redis_cache.redis.ssl_port\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_TLS"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_SECRET_KEY"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_redis_cache.redis.primary_access_key\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_DATA_HOST"')]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_server.postgres.fqdn\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_DATA_DIALECT_OPTIONS"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"{\\"ssl\\": true}"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_DATA_DATABASE_NAME"')]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_database.config_db.name\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_DATA_USERNAME"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_postgresql_server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("postgres"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("administrator_login"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("@"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_postgresql_server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("postgres"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_DATA_PASSWORD"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_server.postgres.administrator_login_password "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# var.postgres.db_password")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_EVENTS_HOST"')]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_server.postgres.fqdn\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_EVENTS_DIALECT_OPTIONS"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"{\\"ssl\\": true}"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_EVENTS_DATABASE_NAME"')]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_database.audit_db.name\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_EVENTS_USERNAME"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_postgresql_server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("postgres"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("administrator_login"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("@"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_postgresql_server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("postgres"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_EVENTS_PASSWORD"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_server.postgres.administrator_login_password "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# var.postgres.db_password")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_AZURE_STORAGE_ACCOUNT_NAME"')]),t._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_storage_account.azure_storage.name\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_AZURE_STORAGE_ACCOUNT_SECRET_KEY"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_storage_account.azure_storage.primary_access_key\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_AZURE_STORAGE_ENDPOINT"')]),t._v("           "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_storage_account.azure_storage.primary_blob_endpoint\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_COSMOSDB_ENDPOINT"')]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_cosmosdb_account.cosmosdb.endpoint\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_COSMOSDB_SECRET_KEY"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_cosmosdb_account.cosmosdb.primary_key\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APPINSIGHTS_INTEGRATION_ENABLED"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APPINSIGHTS_LIVE_METRICS_ENABLED"')]),t._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APPINSIGHTS_INSTRUMENTATION_SECRET_KEY"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_application_insights.app_insights.instrumentation_key\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APPINSIGHTS_CONNECTION_STRING"')]),t._v("          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_application_insights.app_insights.connection_string\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create multiple Azure App Services for the `jobs` tier")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_app_service"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"jobs_tier"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-jobs-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("count")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("index")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-appservice"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("location")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.location\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("resource_group_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.name\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("app_service_plan_id")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_app_service_plan.jobs.id\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("count")]),t._v("               "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.scaling_factors.jobs\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tags")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("product")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.product.name,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("environment")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.environment,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tier")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"jobs"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("enabled")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("https_only")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("site_config")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("linux_fx_version")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.site_config.linux_fx_version\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("min_tls_version")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.site_config.min_tls_version\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("app_command_line")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.site_config.app_command_line\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("always_on")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.site_config.always_on\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("app_settings")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"WEBSITES_ENABLE_APP_SERVICE_STORAGE"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"false"')]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DOCKER_ENABLE_CI"')]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DOCKER_REGISTRY_SERVER_URL"')]),t._v("      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.container_registry.url\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DOCKER_REGISTRY_SERVER_USERNAME"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.container_registry.username\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DOCKER_REGISTRY_SERVER_PASSWORD"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.container_registry.password\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"APP_ROLE"')]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"jobs"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DEPLOY"')]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"self"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"LOG_LEVEL"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"debug"')]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"WEB_PUBLICURL"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://web-'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("."),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("domain"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"API_PUBLICURL"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://api-'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("."),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("domain"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('/api/v1.0"')]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APP_CLIENT_ID"')]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("microsoft_appreg")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("client_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APP_CLIENT_SECRET"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("microsoft_appreg")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("client_secret"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_HOST"')]),t._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_redis_cache.redis.hostname\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_PORT"')]),t._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_redis_cache.redis.ssl_port\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_TLS"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_SECRET_KEY"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_redis_cache.redis.primary_access_key\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_DATA_HOST"')]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_server.postgres.fqdn\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_DATA_DIALECT_OPTIONS"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"{\\"ssl\\": true}"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_DATA_DATABASE_NAME"')]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_database.config_db.name\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_DATA_USERNAME"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_postgresql_server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("postgres"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("administrator_login"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("@"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_postgresql_server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("postgres"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_DATA_PASSWORD"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_server.postgres.administrator_login_password "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# var.postgres.db_password")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_EVENTS_HOST"')]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_server.postgres.fqdn\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_EVENTS_DIALECT_OPTIONS"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"{\\"ssl\\": true}"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_EVENTS_DATABASE_NAME"')]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_database.audit_db.name\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_EVENTS_USERNAME"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_postgresql_server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("postgres"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("administrator_login"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("@"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_postgresql_server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("postgres"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_EVENTS_PASSWORD"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_server.postgres.administrator_login_password "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# var.postgres.db_password")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_AZURE_STORAGE_ACCOUNT_NAME"')]),t._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_storage_account.azure_storage.name\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_AZURE_STORAGE_ACCOUNT_SECRET_KEY"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_storage_account.azure_storage.primary_access_key\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_AZURE_STORAGE_ENDPOINT"')]),t._v("           "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_storage_account.azure_storage.primary_blob_endpoint\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_COSMOSDB_ENDPOINT"')]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_cosmosdb_account.cosmosdb.endpoint\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_COSMOSDB_SECRET_KEY"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_cosmosdb_account.cosmosdb.primary_key\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APPINSIGHTS_INTEGRATION_ENABLED"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APPINSIGHTS_LIVE_METRICS_ENABLED"')]),t._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APPINSIGHTS_INSTRUMENTATION_SECRET_KEY"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_application_insights.app_insights.instrumentation_key\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APPINSIGHTS_CONNECTION_STRING"')]),t._v("          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_application_insights.app_insights.connection_string\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create an Azure App Services for the scheduler service (part of the `jobs` tier)")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_app_service"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"scheduler"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-scheduler-appservice"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("location")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.location\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("resource_group_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.name\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("app_service_plan_id")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_app_service_plan.jobs.id\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tags")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("product")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.product.name,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("environment")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.environment,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tier")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"jobs"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("enabled")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("https_only")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("site_config")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("linux_fx_version")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.site_config.linux_fx_version\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("min_tls_version")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.site_config.min_tls_version\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("app_command_line")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.site_config.app_command_line\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("always_on")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.site_config.always_on\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("app_settings")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"WEBSITES_ENABLE_APP_SERVICE_STORAGE"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"false"')]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DOCKER_ENABLE_CI"')]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DOCKER_REGISTRY_SERVER_URL"')]),t._v("      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.container_registry.url\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DOCKER_REGISTRY_SERVER_USERNAME"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.container_registry.username\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DOCKER_REGISTRY_SERVER_PASSWORD"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.container_registry.password\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"APP_ROLE"')]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"scheduler"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DEPLOY"')]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"self"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"LOG_LEVEL"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"debug"')]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"WEB_PUBLICURL"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://web-'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("."),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("domain"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"API_PUBLICURL"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://api-'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("."),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("domain"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('/api/v1.0"')]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APP_CLIENT_ID"')]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("microsoft_appreg")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("client_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APP_CLIENT_SECRET"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("microsoft_appreg")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("client_secret"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_HOST"')]),t._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_redis_cache.redis.hostname\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_PORT"')]),t._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_redis_cache.redis.ssl_port\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_TLS"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_SECRET_KEY"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_redis_cache.redis.primary_access_key\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_DATA_HOST"')]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_server.postgres.fqdn\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_DATA_DIALECT_OPTIONS"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"{\\"ssl\\": true}"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_DATA_DATABASE_NAME"')]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_database.config_db.name\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_DATA_USERNAME"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_postgresql_server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("postgres"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("administrator_login"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("@"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_postgresql_server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("postgres"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_DATA_PASSWORD"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_server.postgres.administrator_login_password "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# var.postgres.db_password")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_EVENTS_HOST"')]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_server.postgres.fqdn\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_EVENTS_DIALECT_OPTIONS"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"{\\"ssl\\": true}"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_EVENTS_DATABASE_NAME"')]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_database.audit_db.name\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_EVENTS_USERNAME"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_postgresql_server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("postgres"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("administrator_login"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("@"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_postgresql_server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("postgres"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_EVENTS_PASSWORD"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_server.postgres.administrator_login_password "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# var.postgres.db_password")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_AZURE_STORAGE_ACCOUNT_NAME"')]),t._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_storage_account.azure_storage.name\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_AZURE_STORAGE_ACCOUNT_SECRET_KEY"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_storage_account.azure_storage.primary_access_key\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_AZURE_STORAGE_ENDPOINT"')]),t._v("           "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_storage_account.azure_storage.primary_blob_endpoint\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_COSMOSDB_ENDPOINT"')]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_cosmosdb_account.cosmosdb.endpoint\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_COSMOSDB_SECRET_KEY"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_cosmosdb_account.cosmosdb.primary_key\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APPINSIGHTS_INTEGRATION_ENABLED"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APPINSIGHTS_LIVE_METRICS_ENABLED"')]),t._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APPINSIGHTS_INSTRUMENTATION_SECRET_KEY"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_application_insights.app_insights.instrumentation_key\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APPINSIGHTS_CONNECTION_STRING"')]),t._v("          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_application_insights.app_insights.connection_string\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("div",{staticClass:"language-hcl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-hcl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create multiple Azure App Services for the `web` tier")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_app_service"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"web_tier"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-web-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("count")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("index")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-appservice"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("location")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.location\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("resource_group_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.name\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("app_service_plan_id")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_app_service_plan.web.id\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("count")]),t._v("               "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.scaling_factors.web\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tags")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("product")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.product.name,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("environment")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.environment,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tier")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"web"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("enabled")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("https_only")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("site_config")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("linux_fx_version")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.site_config.linux_fx_version\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("min_tls_version")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.site_config.min_tls_version\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("app_command_line")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.site_config.app_command_line\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("always_on")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.site_config.always_on\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("app_settings")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"WEBSITES_ENABLE_APP_SERVICE_STORAGE"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"false"')]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DOCKER_ENABLE_CI"')]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DOCKER_REGISTRY_SERVER_URL"')]),t._v("      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.container_registry.url\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DOCKER_REGISTRY_SERVER_USERNAME"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.container_registry.username\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DOCKER_REGISTRY_SERVER_PASSWORD"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.container_registry.password\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"APP_ROLE"')]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"web"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DEPLOY"')]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"self"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"LOG_LEVEL"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"debug"')]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"WEB_PUBLICURL"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://web-'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("."),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("domain"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"API_PUBLICURL"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://api-'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("."),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("domain"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('/api/v1.0"')]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APP_CLIENT_ID"')]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("microsoft_appreg")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("client_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APP_CLIENT_SECRET"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("microsoft_appreg")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("client_secret"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_HOST"')]),t._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_redis_cache.redis.hostname\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_PORT"')]),t._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_redis_cache.redis.ssl_port\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_DB"')]),t._v("         "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_TLS"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_SECRET_KEY"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_redis_cache.redis.primary_access_key\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_DATA_HOST"')]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_server.postgres.fqdn\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_DATA_DIALECT_OPTIONS"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"{\\"ssl\\": true}"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_DATA_DATABASE_NAME"')]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_database.config_db.name\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_DATA_USERNAME"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_postgresql_server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("postgres"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("administrator_login"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("@"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_postgresql_server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("postgres"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# "${var.postgres.db_username}@${azurerm_postgresql_server.postgres.name}"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_DATA_PASSWORD"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_server.postgres.administrator_login_password                                        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# var.postgres.db_password")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_EVENTS_HOST"')]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_server.postgres.fqdn\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_EVENTS_DIALECT_OPTIONS"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"{\\"ssl\\": true}"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_EVENTS_DATABASE_NAME"')]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_database.audit_db.name\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_EVENTS_USERNAME"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_postgresql_server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("postgres"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("administrator_login"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("@"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_postgresql_server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("postgres"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_EVENTS_PASSWORD"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_server.postgres.administrator_login_password "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# var.postgres.db_password")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_AZURE_STORAGE_ACCOUNT_NAME"')]),t._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_storage_account.azure_storage.name\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_AZURE_STORAGE_ACCOUNT_SECRET_KEY"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_storage_account.azure_storage.primary_access_key\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_AZURE_STORAGE_ENDPOINT"')]),t._v("           "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_storage_account.azure_storage.primary_blob_endpoint\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_COSMOSDB_ENDPOINT"')]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_cosmosdb_account.cosmosdb.endpoint\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_COSMOSDB_SECRET_KEY"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_cosmosdb_account.cosmosdb.primary_key\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APPINSIGHTS_INTEGRATION_ENABLED"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APPINSIGHTS_LIVE_METRICS_ENABLED"')]),t._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APPINSIGHTS_INSTRUMENTATION_SECRET_KEY"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_application_insights.app_insights.instrumentation_key\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APPINSIGHTS_CONNECTION_STRING"')]),t._v("          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_application_insights.app_insights.connection_string\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create multiple Azure App Services for the `api` tier")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_app_service"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"api_tier"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-api-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("count")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("index")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-appservice"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("location")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.location\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("resource_group_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.name\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("app_service_plan_id")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_app_service_plan.api.id\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("count")]),t._v("               "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.scaling_factors.api\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tags")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("product")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.product.name,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("environment")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.environment,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tier")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"api"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("enabled")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("https_only")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("site_config")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("linux_fx_version")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.site_config.linux_fx_version\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("min_tls_version")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.site_config.min_tls_version\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("app_command_line")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.site_config.app_command_line\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("always_on")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.site_config.always_on\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("app_settings")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"WEBSITES_ENABLE_APP_SERVICE_STORAGE"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"false"')]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DOCKER_ENABLE_CI"')]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DOCKER_REGISTRY_SERVER_URL"')]),t._v("      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.container_registry.url\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DOCKER_REGISTRY_SERVER_USERNAME"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.container_registry.username\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DOCKER_REGISTRY_SERVER_PASSWORD"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.container_registry.password\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"APP_ROLE"')]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"api"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DEPLOY"')]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"self"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"LOG_LEVEL"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"debug"')]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"WEB_PUBLICURL"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://web-'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("."),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("domain"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"API_PUBLICURL"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://api-'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("."),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("domain"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('/api/v1.0"')]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APP_CLIENT_ID"')]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("microsoft_appreg")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("client_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APP_CLIENT_SECRET"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("microsoft_appreg")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("client_secret"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_HOST"')]),t._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_redis_cache.redis.hostname\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_PORT"')]),t._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_redis_cache.redis.ssl_port\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_TLS"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_SECRET_KEY"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_redis_cache.redis.primary_access_key\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_DATA_HOST"')]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_server.postgres.fqdn\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_DATA_DIALECT_OPTIONS"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"{\\"ssl\\": true}"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_DATA_DATABASE_NAME"')]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_database.config_db.name\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_DATA_USERNAME"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_postgresql_server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("postgres"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("administrator_login"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("@"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_postgresql_server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("postgres"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_DATA_PASSWORD"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_server.postgres.administrator_login_password "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# var.postgres.db_password")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_EVENTS_HOST"')]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_server.postgres.fqdn\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_EVENTS_DIALECT_OPTIONS"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"{\\"ssl\\": true}"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_EVENTS_DATABASE_NAME"')]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_database.audit_db.name\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_EVENTS_USERNAME"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_postgresql_server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("postgres"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("administrator_login"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("@"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_postgresql_server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("postgres"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_EVENTS_PASSWORD"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_server.postgres.administrator_login_password "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# var.postgres.db_password")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_AZURE_STORAGE_ACCOUNT_NAME"')]),t._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_storage_account.azure_storage.name\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_AZURE_STORAGE_ACCOUNT_SECRET_KEY"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_storage_account.azure_storage.primary_access_key\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_AZURE_STORAGE_ENDPOINT"')]),t._v("           "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_storage_account.azure_storage.primary_blob_endpoint\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_COSMOSDB_ENDPOINT"')]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_cosmosdb_account.cosmosdb.endpoint\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_COSMOSDB_SECRET_KEY"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_cosmosdb_account.cosmosdb.primary_key\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APPINSIGHTS_INTEGRATION_ENABLED"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APPINSIGHTS_LIVE_METRICS_ENABLED"')]),t._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APPINSIGHTS_INSTRUMENTATION_SECRET_KEY"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_application_insights.app_insights.instrumentation_key\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APPINSIGHTS_CONNECTION_STRING"')]),t._v("          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_application_insights.app_insights.connection_string\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create multiple Azure App Services for the `jobs` tier")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_app_service"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"jobs_tier"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-jobs-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("count")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("index")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-appservice"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("location")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.location\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("resource_group_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.name\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("app_service_plan_id")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_app_service_plan.jobs.id\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("count")]),t._v("               "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.scaling_factors.jobs\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tags")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("product")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.product.name,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("environment")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.environment,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tier")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"jobs"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("enabled")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("https_only")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("site_config")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("linux_fx_version")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.site_config.linux_fx_version\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("min_tls_version")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.site_config.min_tls_version\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("app_command_line")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.site_config.app_command_line\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("always_on")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.site_config.always_on\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("app_settings")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"WEBSITES_ENABLE_APP_SERVICE_STORAGE"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"false"')]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DOCKER_ENABLE_CI"')]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DOCKER_REGISTRY_SERVER_URL"')]),t._v("      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.container_registry.url\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DOCKER_REGISTRY_SERVER_USERNAME"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.container_registry.username\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DOCKER_REGISTRY_SERVER_PASSWORD"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.container_registry.password\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"APP_ROLE"')]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"jobs"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DEPLOY"')]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"self"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"LOG_LEVEL"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"debug"')]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"WEB_PUBLICURL"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://web-'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("."),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("domain"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"API_PUBLICURL"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://api-'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("."),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("domain"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('/api/v1.0"')]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APP_CLIENT_ID"')]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("microsoft_appreg")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("client_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APP_CLIENT_SECRET"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("microsoft_appreg")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("client_secret"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_HOST"')]),t._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_redis_cache.redis.hostname\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_PORT"')]),t._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_redis_cache.redis.ssl_port\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_TLS"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_SECRET_KEY"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_redis_cache.redis.primary_access_key\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_DATA_HOST"')]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_server.postgres.fqdn\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_DATA_DIALECT_OPTIONS"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"{\\"ssl\\": true}"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_DATA_DATABASE_NAME"')]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_database.config_db.name\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_DATA_USERNAME"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_postgresql_server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("postgres"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("administrator_login"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("@"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_postgresql_server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("postgres"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_DATA_PASSWORD"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_server.postgres.administrator_login_password "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# var.postgres.db_password")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_EVENTS_HOST"')]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_server.postgres.fqdn\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_EVENTS_DIALECT_OPTIONS"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"{\\"ssl\\": true}"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_EVENTS_DATABASE_NAME"')]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_database.audit_db.name\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_EVENTS_USERNAME"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_postgresql_server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("postgres"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("administrator_login"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("@"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_postgresql_server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("postgres"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_EVENTS_PASSWORD"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_server.postgres.administrator_login_password "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# var.postgres.db_password")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_AZURE_STORAGE_ACCOUNT_NAME"')]),t._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_storage_account.azure_storage.name\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_AZURE_STORAGE_ACCOUNT_SECRET_KEY"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_storage_account.azure_storage.primary_access_key\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_AZURE_STORAGE_ENDPOINT"')]),t._v("           "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_storage_account.azure_storage.primary_blob_endpoint\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_COSMOSDB_ENDPOINT"')]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_cosmosdb_account.cosmosdb.endpoint\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_COSMOSDB_SECRET_KEY"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_cosmosdb_account.cosmosdb.primary_key\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APPINSIGHTS_INTEGRATION_ENABLED"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APPINSIGHTS_LIVE_METRICS_ENABLED"')]),t._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APPINSIGHTS_INSTRUMENTATION_SECRET_KEY"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_application_insights.app_insights.instrumentation_key\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APPINSIGHTS_CONNECTION_STRING"')]),t._v("          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_application_insights.app_insights.connection_string\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create an Azure App Services for the scheduler service (part of the `jobs` tier)")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_app_service"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"scheduler"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-scheduler-appservice"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("location")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.location\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("resource_group_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.name\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("app_service_plan_id")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_app_service_plan.jobs.id\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tags")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("product")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.product.name,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("environment")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.environment,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tier")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"jobs"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("enabled")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("https_only")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("site_config")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("linux_fx_version")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.site_config.linux_fx_version\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("min_tls_version")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.site_config.min_tls_version\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("app_command_line")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.site_config.app_command_line\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("always_on")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.site_config.always_on\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("app_settings")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"WEBSITES_ENABLE_APP_SERVICE_STORAGE"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"false"')]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DOCKER_ENABLE_CI"')]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DOCKER_REGISTRY_SERVER_URL"')]),t._v("      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.container_registry.url\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DOCKER_REGISTRY_SERVER_USERNAME"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.container_registry.username\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DOCKER_REGISTRY_SERVER_PASSWORD"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.container_registry.password\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"APP_ROLE"')]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"scheduler"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DEPLOY"')]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"self"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"LOG_LEVEL"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"debug"')]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"WEB_PUBLICURL"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://web-'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("."),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("domain"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"API_PUBLICURL"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://api-'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("."),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("domain"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('/api/v1.0"')]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APP_CLIENT_ID"')]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("microsoft_appreg")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("client_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APP_CLIENT_SECRET"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("microsoft_appreg")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("client_secret"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_HOST"')]),t._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_redis_cache.redis.hostname\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_PORT"')]),t._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_redis_cache.redis.ssl_port\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_TLS"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_SECRET_KEY"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_redis_cache.redis.primary_access_key\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_DATA_HOST"')]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_server.postgres.fqdn\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_DATA_DIALECT_OPTIONS"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"{\\"ssl\\": true}"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_DATA_DATABASE_NAME"')]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_database.config_db.name\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_DATA_USERNAME"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_postgresql_server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("postgres"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("administrator_login"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("@"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_postgresql_server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("postgres"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_DATA_PASSWORD"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_server.postgres.administrator_login_password "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# var.postgres.db_password")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_EVENTS_HOST"')]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_server.postgres.fqdn\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_EVENTS_DIALECT_OPTIONS"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"{\\"ssl\\": true}"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_EVENTS_DATABASE_NAME"')]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_database.audit_db.name\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_EVENTS_USERNAME"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_postgresql_server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("postgres"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("administrator_login"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("@"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_postgresql_server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("postgres"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_EVENTS_PASSWORD"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_server.postgres.administrator_login_password "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# var.postgres.db_password")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_AZURE_STORAGE_ACCOUNT_NAME"')]),t._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_storage_account.azure_storage.name\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_AZURE_STORAGE_ACCOUNT_SECRET_KEY"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_storage_account.azure_storage.primary_access_key\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_AZURE_STORAGE_ENDPOINT"')]),t._v("           "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_storage_account.azure_storage.primary_blob_endpoint\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_COSMOSDB_ENDPOINT"')]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_cosmosdb_account.cosmosdb.endpoint\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_COSMOSDB_SECRET_KEY"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_cosmosdb_account.cosmosdb.primary_key\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APPINSIGHTS_INTEGRATION_ENABLED"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APPINSIGHTS_LIVE_METRICS_ENABLED"')]),t._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APPINSIGHTS_INSTRUMENTATION_SECRET_KEY"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_application_insights.app_insights.instrumentation_key\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APPINSIGHTS_CONNECTION_STRING"')]),t._v("          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_application_insights.app_insights.connection_string\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("Each tier, "),a("code",[t._v("web")]),t._v(", "),a("code",[t._v("api")]),t._v(" and "),a("code",[t._v("jobs")]),t._v(", could be scaled independently by using the "),a("code",[t._v("scaling_factors")]),t._v(" variables."),a("br"),t._v("\nTo list the available linux runtimes, you can use: "),a("code",[t._v("az webapp list-runtimes or az webapp list-runtimes --linux")]),t._v("."),a("br"),t._v("\nN.B: The scheduler service uses the Application Service Plan from the "),a("code",[t._v("jobs")]),t._v(" tier.\n"),a("a",{attrs:{href:"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/app_service",target:"_blank",rel:"noopener noreferrer"}},[t._v("Learn more..."),a("OutboundLink")],1)]),t._v(" "),a("div",{staticClass:"language-hcl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-hcl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create multiple Azure App Services for the `web` tier")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_app_service"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"web_tier"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-web-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("count")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("index")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-appservice"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("location")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.location\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("resource_group_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.name\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("app_service_plan_id")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_app_service_plan.web.id\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("count")]),t._v("               "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.scaling_factors.web\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tags")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("product")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.product.name,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("environment")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.environment,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tier")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"web"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("enabled")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("https_only")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("site_config")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("linux_fx_version")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.site_config.linux_fx_version\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("min_tls_version")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.site_config.min_tls_version\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("app_command_line")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.site_config.app_command_line\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("always_on")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.site_config.always_on\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("app_settings")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"WEBSITES_ENABLE_APP_SERVICE_STORAGE"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"false"')]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DOCKER_ENABLE_CI"')]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DOCKER_REGISTRY_SERVER_URL"')]),t._v("      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.container_registry.url\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DOCKER_REGISTRY_SERVER_USERNAME"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.container_registry.username\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DOCKER_REGISTRY_SERVER_PASSWORD"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.container_registry.password\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"APP_ROLE"')]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"web"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DEPLOY"')]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"self"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"LOG_LEVEL"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"debug"')]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"WEB_PUBLICURL"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://web-'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("."),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("domain"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"API_PUBLICURL"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://api-'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("."),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("domain"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('/api/v1.0"')]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APP_CLIENT_ID"')]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("microsoft_appreg")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("client_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APP_CLIENT_SECRET"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("microsoft_appreg")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("client_secret"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_HOST"')]),t._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_redis_cache.redis.hostname\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_PORT"')]),t._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_redis_cache.redis.ssl_port\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_DB"')]),t._v("         "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_TLS"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_SECRET_KEY"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_redis_cache.redis.primary_access_key\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_DATA_HOST"')]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_server.postgres.fqdn\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_DATA_DIALECT_OPTIONS"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"{\\"ssl\\": true}"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_DATA_DATABASE_NAME"')]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_database.config_db.name\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_DATA_USERNAME"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_postgresql_server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("postgres"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("administrator_login"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("@"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_postgresql_server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("postgres"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# "${var.postgres.db_username}@${azurerm_postgresql_server.postgres.name}"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_DATA_PASSWORD"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_server.postgres.administrator_login_password                                        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# var.postgres.db_password")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_EVENTS_HOST"')]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_server.postgres.fqdn\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_EVENTS_DIALECT_OPTIONS"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"{\\"ssl\\": true}"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_EVENTS_DATABASE_NAME"')]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_database.audit_db.name\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_EVENTS_USERNAME"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_postgresql_server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("postgres"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("administrator_login"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("@"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_postgresql_server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("postgres"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_EVENTS_PASSWORD"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_server.postgres.administrator_login_password "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# var.postgres.db_password")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_AZURE_STORAGE_ACCOUNT_NAME"')]),t._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_storage_account.azure_storage.name\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_AZURE_STORAGE_ACCOUNT_SECRET_KEY"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_storage_account.azure_storage.primary_access_key\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_AZURE_STORAGE_ENDPOINT"')]),t._v("           "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_storage_account.azure_storage.primary_blob_endpoint\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_COSMOSDB_ENDPOINT"')]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_cosmosdb_account.cosmosdb.endpoint\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_COSMOSDB_SECRET_KEY"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_cosmosdb_account.cosmosdb.primary_key\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APPINSIGHTS_INTEGRATION_ENABLED"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APPINSIGHTS_LIVE_METRICS_ENABLED"')]),t._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APPINSIGHTS_INSTRUMENTATION_SECRET_KEY"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_application_insights.app_insights.instrumentation_key\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APPINSIGHTS_CONNECTION_STRING"')]),t._v("          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_application_insights.app_insights.connection_string\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create multiple Azure App Services for the `api` tier")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_app_service"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"api_tier"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-api-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("count")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("index")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-appservice"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("location")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.location\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("resource_group_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.name\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("app_service_plan_id")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_app_service_plan.api.id\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("count")]),t._v("               "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.scaling_factors.api\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tags")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("product")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.product.name,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("environment")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.environment,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tier")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"api"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("enabled")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("https_only")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("site_config")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("linux_fx_version")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.site_config.linux_fx_version\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("min_tls_version")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.site_config.min_tls_version\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("app_command_line")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.site_config.app_command_line\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("always_on")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.site_config.always_on\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("app_settings")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"WEBSITES_ENABLE_APP_SERVICE_STORAGE"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"false"')]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DOCKER_ENABLE_CI"')]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DOCKER_REGISTRY_SERVER_URL"')]),t._v("      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.container_registry.url\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DOCKER_REGISTRY_SERVER_USERNAME"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.container_registry.username\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DOCKER_REGISTRY_SERVER_PASSWORD"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.container_registry.password\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"APP_ROLE"')]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"api"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DEPLOY"')]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"self"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"LOG_LEVEL"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"debug"')]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"WEB_PUBLICURL"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://web-'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("."),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("domain"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"API_PUBLICURL"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://api-'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("."),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("domain"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('/api/v1.0"')]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APP_CLIENT_ID"')]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("microsoft_appreg")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("client_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APP_CLIENT_SECRET"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("microsoft_appreg")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("client_secret"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_HOST"')]),t._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_redis_cache.redis.hostname\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_PORT"')]),t._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_redis_cache.redis.ssl_port\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_TLS"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_SECRET_KEY"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_redis_cache.redis.primary_access_key\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_DATA_HOST"')]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_server.postgres.fqdn\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_DATA_DIALECT_OPTIONS"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"{\\"ssl\\": true}"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_DATA_DATABASE_NAME"')]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_database.config_db.name\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_DATA_USERNAME"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_postgresql_server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("postgres"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("administrator_login"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("@"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_postgresql_server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("postgres"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_DATA_PASSWORD"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_server.postgres.administrator_login_password "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# var.postgres.db_password")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_EVENTS_HOST"')]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_server.postgres.fqdn\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_EVENTS_DIALECT_OPTIONS"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"{\\"ssl\\": true}"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_EVENTS_DATABASE_NAME"')]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_database.audit_db.name\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_EVENTS_USERNAME"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_postgresql_server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("postgres"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("administrator_login"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("@"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_postgresql_server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("postgres"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_EVENTS_PASSWORD"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_server.postgres.administrator_login_password "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# var.postgres.db_password")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_AZURE_STORAGE_ACCOUNT_NAME"')]),t._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_storage_account.azure_storage.name\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_AZURE_STORAGE_ACCOUNT_SECRET_KEY"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_storage_account.azure_storage.primary_access_key\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_AZURE_STORAGE_ENDPOINT"')]),t._v("           "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_storage_account.azure_storage.primary_blob_endpoint\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_COSMOSDB_ENDPOINT"')]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_cosmosdb_account.cosmosdb.endpoint\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_COSMOSDB_SECRET_KEY"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_cosmosdb_account.cosmosdb.primary_key\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APPINSIGHTS_INTEGRATION_ENABLED"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APPINSIGHTS_LIVE_METRICS_ENABLED"')]),t._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APPINSIGHTS_INSTRUMENTATION_SECRET_KEY"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_application_insights.app_insights.instrumentation_key\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APPINSIGHTS_CONNECTION_STRING"')]),t._v("          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_application_insights.app_insights.connection_string\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create multiple Azure App Services for the `jobs` tier")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_app_service"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"jobs_tier"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-jobs-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("count")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("index")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-appservice"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("location")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.location\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("resource_group_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.name\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("app_service_plan_id")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_app_service_plan.jobs.id\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("count")]),t._v("               "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.scaling_factors.jobs\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tags")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("product")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.product.name,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("environment")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.environment,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tier")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"jobs"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("enabled")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("https_only")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("site_config")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("linux_fx_version")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.site_config.linux_fx_version\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("min_tls_version")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.site_config.min_tls_version\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("app_command_line")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.site_config.app_command_line\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("always_on")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.site_config.always_on\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("app_settings")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"WEBSITES_ENABLE_APP_SERVICE_STORAGE"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"false"')]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DOCKER_ENABLE_CI"')]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DOCKER_REGISTRY_SERVER_URL"')]),t._v("      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.container_registry.url\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DOCKER_REGISTRY_SERVER_USERNAME"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.container_registry.username\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DOCKER_REGISTRY_SERVER_PASSWORD"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.container_registry.password\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"APP_ROLE"')]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"jobs"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DEPLOY"')]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"self"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"LOG_LEVEL"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"debug"')]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"WEB_PUBLICURL"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://web-'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("."),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("domain"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"API_PUBLICURL"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://api-'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("."),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("domain"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('/api/v1.0"')]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APP_CLIENT_ID"')]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("microsoft_appreg")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("client_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APP_CLIENT_SECRET"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("microsoft_appreg")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("client_secret"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_HOST"')]),t._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_redis_cache.redis.hostname\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_PORT"')]),t._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_redis_cache.redis.ssl_port\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_TLS"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_SECRET_KEY"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_redis_cache.redis.primary_access_key\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_DATA_HOST"')]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_server.postgres.fqdn\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_DATA_DIALECT_OPTIONS"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"{\\"ssl\\": true}"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_DATA_DATABASE_NAME"')]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_database.config_db.name\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_DATA_USERNAME"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_postgresql_server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("postgres"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("administrator_login"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("@"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_postgresql_server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("postgres"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_DATA_PASSWORD"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_server.postgres.administrator_login_password "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# var.postgres.db_password")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_EVENTS_HOST"')]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_server.postgres.fqdn\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_EVENTS_DIALECT_OPTIONS"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"{\\"ssl\\": true}"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_EVENTS_DATABASE_NAME"')]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_database.audit_db.name\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_EVENTS_USERNAME"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_postgresql_server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("postgres"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("administrator_login"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("@"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_postgresql_server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("postgres"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_EVENTS_PASSWORD"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_server.postgres.administrator_login_password "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# var.postgres.db_password")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_AZURE_STORAGE_ACCOUNT_NAME"')]),t._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_storage_account.azure_storage.name\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_AZURE_STORAGE_ACCOUNT_SECRET_KEY"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_storage_account.azure_storage.primary_access_key\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_AZURE_STORAGE_ENDPOINT"')]),t._v("           "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_storage_account.azure_storage.primary_blob_endpoint\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_COSMOSDB_ENDPOINT"')]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_cosmosdb_account.cosmosdb.endpoint\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_COSMOSDB_SECRET_KEY"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_cosmosdb_account.cosmosdb.primary_key\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APPINSIGHTS_INTEGRATION_ENABLED"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APPINSIGHTS_LIVE_METRICS_ENABLED"')]),t._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APPINSIGHTS_INSTRUMENTATION_SECRET_KEY"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_application_insights.app_insights.instrumentation_key\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APPINSIGHTS_CONNECTION_STRING"')]),t._v("          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_application_insights.app_insights.connection_string\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create an Azure App Services for the scheduler service (part of the `jobs` tier)")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_app_service"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"scheduler"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-scheduler-appservice"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("location")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.location\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("resource_group_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.name\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("app_service_plan_id")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_app_service_plan.jobs.id\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tags")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("product")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.product.name,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("environment")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.environment,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tier")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"jobs"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("enabled")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("https_only")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("site_config")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("linux_fx_version")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.site_config.linux_fx_version\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("min_tls_version")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.site_config.min_tls_version\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("app_command_line")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.site_config.app_command_line\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("always_on")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.site_config.always_on\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("app_settings")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"WEBSITES_ENABLE_APP_SERVICE_STORAGE"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"false"')]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DOCKER_ENABLE_CI"')]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DOCKER_REGISTRY_SERVER_URL"')]),t._v("      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.container_registry.url\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DOCKER_REGISTRY_SERVER_USERNAME"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.container_registry.username\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DOCKER_REGISTRY_SERVER_PASSWORD"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.container_registry.password\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"APP_ROLE"')]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"scheduler"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DEPLOY"')]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"self"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"LOG_LEVEL"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"debug"')]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"WEB_PUBLICURL"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://web-'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("."),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("domain"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"API_PUBLICURL"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://api-'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("."),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("domain"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('/api/v1.0"')]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APP_CLIENT_ID"')]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("microsoft_appreg")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("client_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APP_CLIENT_SECRET"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("microsoft_appreg")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("client_secret"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_HOST"')]),t._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_redis_cache.redis.hostname\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_PORT"')]),t._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_redis_cache.redis.ssl_port\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_TLS"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_SECRET_KEY"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_redis_cache.redis.primary_access_key\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_DATA_HOST"')]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_server.postgres.fqdn\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_DATA_DIALECT_OPTIONS"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"{\\"ssl\\": true}"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_DATA_DATABASE_NAME"')]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_database.config_db.name\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_DATA_USERNAME"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_postgresql_server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("postgres"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("administrator_login"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("@"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_postgresql_server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("postgres"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_DATA_PASSWORD"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_server.postgres.administrator_login_password "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# var.postgres.db_password")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_EVENTS_HOST"')]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_server.postgres.fqdn\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_EVENTS_DIALECT_OPTIONS"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"{\\"ssl\\": true}"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_EVENTS_DATABASE_NAME"')]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_database.audit_db.name\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_EVENTS_USERNAME"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_postgresql_server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("postgres"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("administrator_login"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("@"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_postgresql_server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("postgres"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DB_EVENTS_PASSWORD"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_server.postgres.administrator_login_password "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# var.postgres.db_password")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_AZURE_STORAGE_ACCOUNT_NAME"')]),t._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_storage_account.azure_storage.name\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_AZURE_STORAGE_ACCOUNT_SECRET_KEY"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_storage_account.azure_storage.primary_access_key\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_AZURE_STORAGE_ENDPOINT"')]),t._v("           "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_storage_account.azure_storage.primary_blob_endpoint\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_COSMOSDB_ENDPOINT"')]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_cosmosdb_account.cosmosdb.endpoint\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_COSMOSDB_SECRET_KEY"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_cosmosdb_account.cosmosdb.primary_key\n\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APPINSIGHTS_INTEGRATION_ENABLED"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APPINSIGHTS_LIVE_METRICS_ENABLED"')]),t._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APPINSIGHTS_INSTRUMENTATION_SECRET_KEY"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_application_insights.app_insights.instrumentation_key\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MICROSOFT_APPINSIGHTS_CONNECTION_STRING"')]),t._v("          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_application_insights.app_insights.connection_string\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"azure-front-door"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#azure-front-door"}},[t._v("#")]),t._v(" Azure Front Door")]),t._v(" "),a("p",[t._v("Azure Front Door is an all-in-one service that is used to provide the following services to the SalesTim platform")]),t._v(" "),a("ul",[a("li",[t._v("HTTP load balancing")]),t._v(" "),a("li",[t._v("Web Application Firewall")]),t._v(" "),a("li",[a("div",{staticClass:"language-hcl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-hcl"}},[a("code")])]),a("div",{staticClass:"language-hcl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-hcl"}},[a("code")])]),t._v("SSL certificates managemnet and HTTPS enforcement\n"),a("a",{attrs:{href:"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/frontdoor",target:"_blank",rel:"noopener noreferrer"}},[t._v("Learn more..."),a("OutboundLink")],1)]),t._v(" "),a("div",{staticClass:"language-hcl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-hcl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create the Azure Front Door resource")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_frontdoor"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"afd"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                                         "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-afd"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("resource_group_name")]),t._v("                          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.name\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("enforce_backend_pools_certificate_name_check")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("load_balancer_enabled")]),t._v("                        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("backend_pools_send_receive_timeout_seconds")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("60")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tags")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("product")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.product.name,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("environment")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.environment,\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Front door must always contain the default associated frontend endpoint")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("frontend_endpoint")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                                    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default-frontend-endpoint"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("host_name")]),t._v("                               "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-afd.azurefd.net"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("session_affinity_enabled")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("session_affinity_ttl_seconds")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("web_application_firewall_policy_link_id")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create public endpoints")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("frontend_endpoint")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                                    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"web-frontend-endpoint"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("host_name")]),t._v("                               "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"web-'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("."),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("domain"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("session_affinity_enabled")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("session_affinity_ttl_seconds")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("web_application_firewall_policy_link_id")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("frontend_endpoint")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                                    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"api-frontend-endpoint"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("host_name")]),t._v("                               "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"api-'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("."),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("domain"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("session_affinity_enabled")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("session_affinity_ttl_seconds")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("web_application_firewall_policy_link_id")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create a routing rule that enforces HTTPS")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("routing_rule")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("               "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http-to-https-redirect"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("frontend_endpoints")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"web-frontend-endpoint"')]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"api-frontend-endpoint"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("accepted_protocols")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Http"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("patterns_to_match")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/*"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("enabled")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("redirect_configuration")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("redirect_protocol")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"HttpsOnly"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("redirect_type")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Moved"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create a routing rule for each public endpoint")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("routing_rule")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("               "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"web-tier-routing-rule"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("frontend_endpoints")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"web-frontend-endpoint"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("accepted_protocols")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Https"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("patterns_to_match")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/*"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("enabled")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("forwarding_configuration")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("backend_pool_name")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"web-tier-backend-pool"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("cache_enabled")]),t._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("forwarding_protocol")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"HttpsOnly"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("routing_rule")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("               "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"api-tier-routing-rule"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("frontend_endpoints")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"api-frontend-endpoint"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("accepted_protocols")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Https"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("patterns_to_match")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/*"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("enabled")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("forwarding_configuration")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("backend_pool_name")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"api-tier-backend-pool"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("cache_enabled")]),t._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("forwarding_protocol")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"HttpsOnly"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create a backend pool for each public endpoint")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("backend_pool")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"web-tier-backend-pool"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("backend")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("enabled")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("address")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-web-1-appservice.azurewebsites.net"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("host_header")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-web-1-appservice.azurewebsites.net"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("http_port")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("https_port")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("priority")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("weight")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("backend")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("enabled")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("address")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-web-2-appservice.azurewebsites.net"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("host_header")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-web-2-appservice.azurewebsites.net"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("http_port")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("https_port")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("priority")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("weight")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("health_probe_name")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"backend-pool-health-probe"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("load_balancing_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"backend-pool-load-balancing"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("backend_pool")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"api-tier-backend-pool"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("backend")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("enabled")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("address")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-api-1-appservice.azurewebsites.net"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("host_header")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-api-1-appservice.azurewebsites.net"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("http_port")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("https_port")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("priority")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("weight")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("backend")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("enabled")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("address")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-api-2-appservice.azurewebsites.net"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("host_header")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-api-2-appservice.azurewebsites.net"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("http_port")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("https_port")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("priority")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("weight")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("health_probe_name")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"backend-pool-health-probe"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("load_balancing_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"backend-pool-load-balancing"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Define common (shared by all the backend pools) health probes policy")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("backend_pool_health_probe")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"backend-pool-health-probe"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("enabled")]),t._v("             "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("path")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/monitoring/ping"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("protocol")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Https"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("probe_method")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"HEAD"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("interval_in_seconds")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("120")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Define common (shared by all the backend pools) load balancing policy")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("backend_pool_load_balancing")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"backend-pool-load-balancing"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("sample_size")]),t._v("                     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("successful_samples_required")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("additional_latency_milliseconds")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Define HTTPS configurations for each endpoint")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# See https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/frontdoor_custom_https_configuration")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Don't apply custom HTTPS configuration to the default endpoint")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_frontdoor_custom_https_configuration"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default_https"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("frontend_endpoint_id")]),t._v("              "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_frontdoor.afd.frontend_endpoints"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default-frontend-endpoint"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("custom_https_provisioning_enabled")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Apply custom HTTPS configuration to the web endpoint, using an autmatically generated certificate by Azure Front Door itself.")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_frontdoor_custom_https_configuration"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"web_https"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("frontend_endpoint_id")]),t._v("              "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_frontdoor.afd.frontend_endpoints"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"web-frontend-endpoint"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("custom_https_provisioning_enabled")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("custom_https_configuration")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("certificate_source")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"FrontDoor"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Apply custom HTTPS configuration to the api endpoint, using an autmatically generated certificate by Azure Front Door itself.")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_frontdoor_custom_https_configuration"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"api_https"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("frontend_endpoint_id")]),t._v("              "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_frontdoor.afd.frontend_endpoints"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"api-frontend-endpoint"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("custom_https_provisioning_enabled")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("custom_https_configuration")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("certificate_source")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"FrontDoor"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),a("div",{staticClass:"language-hcl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-hcl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create the Azure Front Door resource")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_frontdoor"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"afd"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                                         "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-afd"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("resource_group_name")]),t._v("                          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.name\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("enforce_backend_pools_certificate_name_check")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("load_balancer_enabled")]),t._v("                        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("backend_pools_send_receive_timeout_seconds")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("60")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tags")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("product")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.product.name,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("environment")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.environment,\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Front door must always contain the default associated frontend endpoint")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("frontend_endpoint")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                                    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default-frontend-endpoint"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("host_name")]),t._v("                               "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-afd.azurefd.net"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("session_affinity_enabled")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("session_affinity_ttl_seconds")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("web_application_firewall_policy_link_id")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create public endpoints")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("frontend_endpoint")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                                    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"web-frontend-endpoint"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("host_name")]),t._v("                               "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"web-'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("."),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("domain"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("session_affinity_enabled")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("session_affinity_ttl_seconds")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("web_application_firewall_policy_link_id")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("frontend_endpoint")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                                    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"api-frontend-endpoint"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("host_name")]),t._v("                               "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"api-'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("."),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("domain"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("session_affinity_enabled")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("session_affinity_ttl_seconds")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("web_application_firewall_policy_link_id")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create a routing rule that enforces HTTPS")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("routing_rule")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("               "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http-to-https-redirect"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("frontend_endpoints")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"web-frontend-endpoint"')]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"api-frontend-endpoint"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("accepted_protocols")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Http"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("patterns_to_match")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/*"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("enabled")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("redirect_configuration")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("redirect_protocol")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"HttpsOnly"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("redirect_type")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Moved"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create a routing rule for each public endpoint")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("routing_rule")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("               "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"web-tier-routing-rule"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("frontend_endpoints")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"web-frontend-endpoint"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("accepted_protocols")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Https"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("patterns_to_match")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/*"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("enabled")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("forwarding_configuration")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("backend_pool_name")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"web-tier-backend-pool"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("cache_enabled")]),t._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("forwarding_protocol")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"HttpsOnly"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("routing_rule")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("               "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"api-tier-routing-rule"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("frontend_endpoints")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"api-frontend-endpoint"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("accepted_protocols")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Https"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("patterns_to_match")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/*"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("enabled")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("forwarding_configuration")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("backend_pool_name")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"api-tier-backend-pool"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("cache_enabled")]),t._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("forwarding_protocol")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"HttpsOnly"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create a backend pool for each public endpoint")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("backend_pool")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"web-tier-backend-pool"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("backend")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("enabled")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("address")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-web-1-appservice.azurewebsites.net"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("host_header")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-web-1-appservice.azurewebsites.net"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("http_port")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("https_port")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("priority")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("weight")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("backend")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("enabled")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("address")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-web-2-appservice.azurewebsites.net"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("host_header")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-web-2-appservice.azurewebsites.net"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("http_port")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("https_port")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("priority")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("weight")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("health_probe_name")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"backend-pool-health-probe"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("load_balancing_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"backend-pool-load-balancing"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("backend_pool")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"api-tier-backend-pool"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("backend")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("enabled")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("address")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-api-1-appservice.azurewebsites.net"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("host_header")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-api-1-appservice.azurewebsites.net"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("http_port")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("https_port")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("priority")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("weight")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("backend")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("enabled")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("address")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-api-2-appservice.azurewebsites.net"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("host_header")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-api-2-appservice.azurewebsites.net"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("http_port")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("https_port")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("priority")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("weight")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("health_probe_name")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"backend-pool-health-probe"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("load_balancing_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"backend-pool-load-balancing"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Define common (shared by all the backend pools) health probes policy")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("backend_pool_health_probe")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"backend-pool-health-probe"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("enabled")]),t._v("             "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("path")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/monitoring/ping"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("protocol")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Https"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("probe_method")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"HEAD"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("interval_in_seconds")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("120")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Define common (shared by all the backend pools) load balancing policy")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("backend_pool_load_balancing")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"backend-pool-load-balancing"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("sample_size")]),t._v("                     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("successful_samples_required")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("additional_latency_milliseconds")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Define HTTPS configurations for each endpoint")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# See https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/frontdoor_custom_https_configuration")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Don't apply custom HTTPS configuration to the default endpoint")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_frontdoor_custom_https_configuration"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default_https"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("frontend_endpoint_id")]),t._v("              "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_frontdoor.afd.frontend_endpoints"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default-frontend-endpoint"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("custom_https_provisioning_enabled")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Apply custom HTTPS configuration to the web endpoint, using an autmatically generated certificate by Azure Front Door itself.")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_frontdoor_custom_https_configuration"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"web_https"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("frontend_endpoint_id")]),t._v("              "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_frontdoor.afd.frontend_endpoints"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"web-frontend-endpoint"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("custom_https_provisioning_enabled")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("custom_https_configuration")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("certificate_source")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"FrontDoor"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Apply custom HTTPS configuration to the api endpoint, using an autmatically generated certificate by Azure Front Door itself.")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_frontdoor_custom_https_configuration"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"api_https"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("frontend_endpoint_id")]),t._v("              "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_frontdoor.afd.frontend_endpoints"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"api-frontend-endpoint"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("custom_https_provisioning_enabled")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("custom_https_configuration")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("certificate_source")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"FrontDoor"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"monitoring-components"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#monitoring-components"}},[t._v("#")]),t._v(" Monitoring components")]),t._v(" "),a("h3",{attrs:{id:"azure-monitoring-app-service-plan"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#azure-monitoring-app-service-plan"}},[t._v("#")]),t._v(" Azure Monitoring App Service Plan")]),t._v(" "),a("div",{staticClass:"language-hcl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-hcl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create an Azure App Service Plan for the `monitoring` tier")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_app_service_plan"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"monitoring"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-monitoring-asp"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("location")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.location\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("resource_group_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.name\n\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tags")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("product")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.product.name,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("environment")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.environment,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tier")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"monitoring"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("kind")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Linux"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("reserved")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("sku")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tier")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Premium"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("size")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"P2V2"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("div",{staticClass:"language-hcl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-hcl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create an Azure App Service Plan for the `monitoring` tier")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_app_service_plan"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"monitoring"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-monitoring-asp"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("location")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.location\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("resource_group_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.name\n\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tags")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("product")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.product.name,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("environment")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.environment,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tier")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"monitoring"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("kind")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Linux"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("reserved")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("sku")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tier")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Premium"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("size")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"P2V2"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("To make things easier, we'll create a single App Service Plan for the monitoring resources. In production, we recommend to create distincts App Service Plans for each monitoring service."),a("br"),t._v(" "),a("a",{attrs:{href:"https://prometheus.io",target:"_blank",rel:"noopener noreferrer"}},[t._v("Learn more..."),a("OutboundLink")],1)]),t._v(" "),a("div",{staticClass:"language-hcl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-hcl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create an Azure App Service Plan for the `monitoring` tier")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_app_service_plan"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"monitoring"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-monitoring-asp"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("location")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.location\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("resource_group_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.name\n\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tags")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("product")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.product.name,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("environment")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.environment,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tier")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"monitoring"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("kind")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Linux"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("reserved")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("sku")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tier")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Premium"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("size")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"P2V2"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"events-collector-app-service"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#events-collector-app-service"}},[t._v("#")]),t._v(" Events Collector App Service")]),t._v(" "),a("div",{staticClass:"language-hcl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-hcl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create the audit database")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_postgresql_database"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"audit_db"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-audit-database"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("resource_group_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.name\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("server_name")]),t._v("         "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_server.postgres.name\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("charset")]),t._v("             "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"UTF8"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("collation")]),t._v("           "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"English_United States.1252"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create the events collector service")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# N.B: Events collector service could be scaled by using the `scaling_factors` variables.  ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_app_service"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"events_collector"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-eventscollector-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("count")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("index")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-appservice"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("location")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.location\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("resource_group_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.name\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("app_service_plan_id")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_app_service_plan.monitoring.id\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tags")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("product")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.product.name,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("environment")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.environment,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tier")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"monitoring"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("count")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.scaling_factors.jitsu\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("enabled")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("https_only")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("site_config")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("linux_fx_version")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"DOCKER|jitsucom/server:latest"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("min_tls_version")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.site_config.min_tls_version\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("always_on")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("app_settings")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"WEBSITES_ENABLE_APP_SERVICE_STORAGE"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DOCKER_ENABLE_CI"')]),t._v("                    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"SERVER_NAME"')]),t._v("                         "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"jitsu_'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("count")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("index")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"PORT"')]),t._v("                                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_URL"')]),t._v("                           "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redis:'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_redis_cache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hostname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v(":"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_redis_cache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ssl_port"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("?db=0&password="),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_redis_cache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("primary_access_key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"TLS_SKIP_VERIFY"')]),t._v("                     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"USER_RECOGNITION_ENABLED"')]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"SERVER_ADMIN_TOKEN"')]),t._v("                  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("events_collector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("EVENTSCOLLECTOR_AUTH_ADMIN_TOKEN"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("div",{staticClass:"language-hcl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-hcl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create the audit database")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_postgresql_database"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"audit_db"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-audit-database"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("resource_group_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.name\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("server_name")]),t._v("         "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_server.postgres.name\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("charset")]),t._v("             "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"UTF8"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("collation")]),t._v("           "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"English_United States.1252"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create the events collector service")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# N.B: Events collector service could be scaled by using the `scaling_factors` variables.  ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_app_service"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"events_collector"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-eventscollector-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("count")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("index")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-appservice"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("location")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.location\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("resource_group_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.name\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("app_service_plan_id")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_app_service_plan.monitoring.id\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tags")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("product")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.product.name,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("environment")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.environment,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tier")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"monitoring"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("count")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.scaling_factors.jitsu\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("enabled")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("https_only")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("site_config")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("linux_fx_version")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"DOCKER|jitsucom/server:latest"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("min_tls_version")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.site_config.min_tls_version\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("always_on")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("app_settings")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"WEBSITES_ENABLE_APP_SERVICE_STORAGE"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DOCKER_ENABLE_CI"')]),t._v("                    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"SERVER_NAME"')]),t._v("                         "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"jitsu_'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("count")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("index")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"PORT"')]),t._v("                                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_URL"')]),t._v("                           "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redis:'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_redis_cache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hostname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v(":"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_redis_cache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ssl_port"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("?db=0&password="),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_redis_cache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("primary_access_key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"TLS_SKIP_VERIFY"')]),t._v("                     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"USER_RECOGNITION_ENABLED"')]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"SERVER_ADMIN_TOKEN"')]),t._v("                  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("events_collector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("EVENTSCOLLECTOR_AUTH_ADMIN_TOKEN"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("The event collector app is used to collect and distribute the "),a("RouterLink",{attrs:{to:"/hosting/references/EVENTS.html"}},[t._v("application events")]),t._v(" and audit trails to a storage service."),a("br"),t._v("\nThe following configuration creates a container for the "),a("a",{attrs:{href:"https://github.com/jitsucom/jitsu",target:"_blank",rel:"noopener noreferrer"}},[t._v("Jitsu"),a("OutboundLink")],1),t._v(" service, using the "),a("a",{attrs:{href:"https://jitsu.com/docs/deployment/deploy-with-docker/jitsu-server",target:"_blank",rel:"noopener noreferrer"}},[t._v("@jitsuco/server"),a("OutboundLink")],1),t._v(" standalone image."),a("br"),t._v("\nIt also creates a dedicated audit database for the events collector for isolation purposes."),a("br"),t._v(" "),a("a",{attrs:{href:"https://jitsu.com/docs/deployment/deploy-with-docker",target:"_blank",rel:"noopener noreferrer"}},[t._v("Learn more..."),a("OutboundLink")],1)],1),t._v(" "),a("div",{staticClass:"language-hcl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-hcl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create the audit database")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_postgresql_database"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"audit_db"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-audit-database"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("resource_group_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.name\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("server_name")]),t._v("         "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_postgresql_server.postgres.name\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("charset")]),t._v("             "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"UTF8"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("collation")]),t._v("           "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"English_United States.1252"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create the events collector service")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# N.B: Events collector service could be scaled by using the `scaling_factors` variables.  ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_app_service"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"events_collector"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-eventscollector-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("count")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("index")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-appservice"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("location")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.location\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("resource_group_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.name\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("app_service_plan_id")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_app_service_plan.monitoring.id\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tags")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("product")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.product.name,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("environment")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.environment,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tier")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"monitoring"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("count")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.scaling_factors.jitsu\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("enabled")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("https_only")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("site_config")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("linux_fx_version")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"DOCKER|jitsucom/server:latest"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("min_tls_version")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.site_config.min_tls_version\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("always_on")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("app_settings")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"WEBSITES_ENABLE_APP_SERVICE_STORAGE"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DOCKER_ENABLE_CI"')]),t._v("                    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"SERVER_NAME"')]),t._v("                         "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"jitsu_'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("count")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("index")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"PORT"')]),t._v("                                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_URL"')]),t._v("                           "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redis:'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_redis_cache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hostname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v(":"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_redis_cache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ssl_port"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("?db=0&password="),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_redis_cache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("primary_access_key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"TLS_SKIP_VERIFY"')]),t._v("                     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"USER_RECOGNITION_ENABLED"')]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"SERVER_ADMIN_TOKEN"')]),t._v("                  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("events_collector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("EVENTSCOLLECTOR_AUTH_ADMIN_TOKEN"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"azure-application-insights"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#azure-application-insights"}},[t._v("#")]),t._v(" Azure Application Insights")]),t._v(" "),a("div",{staticClass:"language-hcl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-hcl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_application_insights"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"app_insights"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-app-insights"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("location")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.location\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("resource_group_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.name\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("application_type")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Node.JS"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("retention_in_days")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tags")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("product")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.product.name,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("environment")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.environment,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tier")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"monitoring"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("div",{staticClass:"language-hcl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-hcl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_application_insights"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"app_insights"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-app-insights"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("location")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.location\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("resource_group_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.name\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("application_type")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Node.JS"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("retention_in_days")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tags")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("product")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.product.name,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("environment")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.environment,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tier")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"monitoring"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("The Azure Application Insights service is used to collect application traces and performance metrics for diagnostic and analytical purposes."),a("br"),t._v(" "),a("a",{attrs:{href:"https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/application_insights",target:"_blank",rel:"noopener noreferrer"}},[t._v("Learn more..."),a("OutboundLink")],1)]),t._v(" "),a("div",{staticClass:"language-hcl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-hcl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_application_insights"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"app_insights"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-app-insights"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("location")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.location\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("resource_group_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.name\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("application_type")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Node.JS"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("retention_in_days")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tags")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("product")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.product.name,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("environment")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.environment,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tier")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"monitoring"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"prometheus-app-service"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#prometheus-app-service"}},[t._v("#")]),t._v(" Prometheus App Service")]),t._v(" "),a("div",{staticClass:"language-hcl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-hcl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create the Prometheus service")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_app_service"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"prometheus"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-prometheus-appservice"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("location")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.location\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("resource_group_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.name\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("app_service_plan_id")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_app_service_plan.monitoring.id\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tags")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("product")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.product.name,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("environment")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.environment,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tier")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"monitoring"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("enabled")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("https_only")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("site_config")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("linux_fx_version")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"DOCKER|prom/prometheus:latest"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("min_tls_version")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.site_config.min_tls_version\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("always_on")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Volume for the Prometheus configuration")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# volumes {")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('#   host_path      = "${path.cwd}/volumes/prometheus/conf/prometheus.yml"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('#   container_path = "/etc/prometheus/prometheus.yml"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   read_only      = true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# }")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("app_settings")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"WEBSITES_ENABLE_APP_SERVICE_STORAGE"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"false"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DOCKER_ENABLE_CI"')]),t._v("                    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"LISTEN_ADDRESS"')]),t._v("                      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0.0.0.0"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"LISTEN_PORT"')]),t._v("                         "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9090")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("div",{staticClass:"language-hcl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-hcl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create the Prometheus service")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_app_service"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"prometheus"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-prometheus-appservice"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("location")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.location\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("resource_group_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.name\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("app_service_plan_id")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_app_service_plan.monitoring.id\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tags")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("product")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.product.name,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("environment")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.environment,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tier")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"monitoring"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("enabled")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("https_only")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("site_config")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("linux_fx_version")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"DOCKER|prom/prometheus:latest"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("min_tls_version")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.site_config.min_tls_version\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("always_on")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Volume for the Prometheus configuration")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# volumes {")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('#   host_path      = "${path.cwd}/volumes/prometheus/conf/prometheus.yml"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('#   container_path = "/etc/prometheus/prometheus.yml"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   read_only      = true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# }")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("app_settings")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"WEBSITES_ENABLE_APP_SERVICE_STORAGE"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"false"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DOCKER_ENABLE_CI"')]),t._v("                    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"LISTEN_ADDRESS"')]),t._v("                      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0.0.0.0"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"LISTEN_PORT"')]),t._v("                         "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9090")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("Prometheus is used to collect all the metrics from the whole platform."),a("br"),t._v(" "),a("a",{attrs:{href:"https://hub.docker.com/r/prom/prometheus/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Learn more..."),a("OutboundLink")],1)]),t._v(" "),a("div",{staticClass:"language-hcl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-hcl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create the Prometheus service")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_app_service"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"prometheus"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-prometheus-appservice"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("location")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.location\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("resource_group_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.name\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("app_service_plan_id")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_app_service_plan.monitoring.id\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tags")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("product")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.product.name,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("environment")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.environment,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tier")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"monitoring"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("enabled")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("https_only")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("site_config")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("linux_fx_version")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"DOCKER|prom/prometheus:latest"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("min_tls_version")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.site_config.min_tls_version\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("always_on")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Volume for the Prometheus configuration")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# volumes {")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('#   host_path      = "${path.cwd}/volumes/prometheus/conf/prometheus.yml"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('#   container_path = "/etc/prometheus/prometheus.yml"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   read_only      = true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# }")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("app_settings")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"WEBSITES_ENABLE_APP_SERVICE_STORAGE"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"false"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DOCKER_ENABLE_CI"')]),t._v("                    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"LISTEN_ADDRESS"')]),t._v("                      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0.0.0.0"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"LISTEN_PORT"')]),t._v("                         "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9090")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"redis-prometheus-exporter-app-service"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#redis-prometheus-exporter-app-service"}},[t._v("#")]),t._v(" Redis Prometheus Exporter App Service")]),t._v(" "),a("div",{staticClass:"language-hcl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-hcl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create the Redis Prometheus exporter service")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_app_service"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redis_prometheus_exporter"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-redisprometheusexporter-appservice"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("location")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.location\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("resource_group_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.name\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("app_service_plan_id")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_app_service_plan.monitoring.id\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tags")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("product")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.product.name,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("environment")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.environment,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tier")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"monitoring"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("enabled")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("https_only")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("site_config")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("linux_fx_version")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"DOCKER|oliver006/redis_exporter:latest"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("min_tls_version")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.site_config.min_tls_version\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("always_on")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("app_settings")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"WEBSITES_ENABLE_APP_SERVICE_STORAGE"')]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"false"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DOCKER_ENABLE_CI"')]),t._v("                     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_ADDR"')]),t._v("                           "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redis:'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_redis_cache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hostname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v(":"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_redis_cache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ssl_port"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_PASSWORD"')]),t._v("                       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_redis_cache.redis.primary_access_key\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_EXPORTER_WEB_LISTEN_ADDRESS"')]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0.0.0.0:80"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_EXPORTER_WEB_TELEMETRY_PATH"')]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/metrics"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_EXPORTER_NAMESPACE"')]),t._v("             "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redis"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_EXPORTER_INCL_SYSTEM_METRICS"')]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_EXPORTER_SKIP_TLS_VERIFICATION"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_EXPORTER_PING_ON_CONNECT"')]),t._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("div",{staticClass:"language-hcl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-hcl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create the Redis Prometheus exporter service")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_app_service"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redis_prometheus_exporter"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-redisprometheusexporter-appservice"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("location")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.location\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("resource_group_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.name\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("app_service_plan_id")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_app_service_plan.monitoring.id\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tags")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("product")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.product.name,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("environment")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.environment,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tier")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"monitoring"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("enabled")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("https_only")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("site_config")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("linux_fx_version")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"DOCKER|oliver006/redis_exporter:latest"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("min_tls_version")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.site_config.min_tls_version\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("always_on")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("app_settings")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"WEBSITES_ENABLE_APP_SERVICE_STORAGE"')]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"false"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DOCKER_ENABLE_CI"')]),t._v("                     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_ADDR"')]),t._v("                           "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redis:'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_redis_cache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hostname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v(":"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_redis_cache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ssl_port"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_PASSWORD"')]),t._v("                       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_redis_cache.redis.primary_access_key\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_EXPORTER_WEB_LISTEN_ADDRESS"')]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0.0.0.0:80"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_EXPORTER_WEB_TELEMETRY_PATH"')]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/metrics"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_EXPORTER_NAMESPACE"')]),t._v("             "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redis"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_EXPORTER_INCL_SYSTEM_METRICS"')]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_EXPORTER_SKIP_TLS_VERIFICATION"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_EXPORTER_PING_ON_CONNECT"')]),t._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("The "),a("a",{attrs:{href:"https://github.com/oliver006/redis_exporter",target:"_blank",rel:"noopener noreferrer"}},[t._v("Redis Prometheus exporter"),a("OutboundLink")],1),t._v(" exposes metrics from the Redis service\n"),a("a",{attrs:{href:"https://prometheus.io",target:"_blank",rel:"noopener noreferrer"}},[t._v("Learn more..."),a("OutboundLink")],1)]),t._v(" "),a("div",{staticClass:"language-hcl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-hcl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create the Redis Prometheus exporter service")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_app_service"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redis_prometheus_exporter"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-redisprometheusexporter-appservice"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("location")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.location\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("resource_group_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.name\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("app_service_plan_id")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_app_service_plan.monitoring.id\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tags")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("product")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.product.name,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("environment")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.environment,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tier")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"monitoring"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("enabled")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("https_only")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("site_config")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("linux_fx_version")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"DOCKER|oliver006/redis_exporter:latest"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("min_tls_version")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.site_config.min_tls_version\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("always_on")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("app_settings")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"WEBSITES_ENABLE_APP_SERVICE_STORAGE"')]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"false"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DOCKER_ENABLE_CI"')]),t._v("                     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_ADDR"')]),t._v("                           "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redis:'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_redis_cache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hostname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v(":"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_redis_cache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ssl_port"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_PASSWORD"')]),t._v("                       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_redis_cache.redis.primary_access_key\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_EXPORTER_WEB_LISTEN_ADDRESS"')]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0.0.0.0:80"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_EXPORTER_WEB_TELEMETRY_PATH"')]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/metrics"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_EXPORTER_NAMESPACE"')]),t._v("             "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redis"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_EXPORTER_INCL_SYSTEM_METRICS"')]),t._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_EXPORTER_SKIP_TLS_VERIFICATION"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"REDIS_EXPORTER_PING_ON_CONNECT"')]),t._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"bull-prometheus-exporter-app-service"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#bull-prometheus-exporter-app-service"}},[t._v("#")]),t._v(" Bull Prometheus Exporter App Service")]),t._v(" "),a("div",{staticClass:"language-hcl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-hcl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create the Bull Prometheus exporter service")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_app_service"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"bull_prometheus_exporter"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-bullprometheusexporter-appservice"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("location")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.location\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("resource_group_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.name\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("app_service_plan_id")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_app_service_plan.monitoring.id\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tags")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("product")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.product.name,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("environment")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.environment,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tier")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"monitoring"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("enabled")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("https_only")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("site_config")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("linux_fx_version")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"DOCKER|uphabit/bull_exporter:latest"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("min_tls_version")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.site_config.min_tls_version\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("always_on")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("app_settings")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"WEBSITES_ENABLE_APP_SERVICE_STORAGE"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"false"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DOCKER_ENABLE_CI"')]),t._v("                    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"EXPORTER_REDIS_URL"')]),t._v("                  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redis:'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_redis_cache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hostname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v(":"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_redis_cache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ssl_port"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("?db=0&password="),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_redis_cache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("primary_access_key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"EXPORTER_PREFIX"')]),t._v("                     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"st:queues"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"EXPORTER_STAT_PREFIX"')]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"bull_queue_"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("div",{staticClass:"language-hcl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-hcl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create the Bull Prometheus exporter service")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_app_service"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"bull_prometheus_exporter"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-bullprometheusexporter-appservice"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("location")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.location\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("resource_group_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.name\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("app_service_plan_id")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_app_service_plan.monitoring.id\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tags")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("product")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.product.name,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("environment")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.environment,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tier")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"monitoring"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("enabled")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("https_only")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("site_config")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("linux_fx_version")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"DOCKER|uphabit/bull_exporter:latest"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("min_tls_version")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.site_config.min_tls_version\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("always_on")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("app_settings")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"WEBSITES_ENABLE_APP_SERVICE_STORAGE"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"false"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DOCKER_ENABLE_CI"')]),t._v("                    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"EXPORTER_REDIS_URL"')]),t._v("                  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redis:'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_redis_cache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hostname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v(":"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_redis_cache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ssl_port"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("?db=0&password="),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_redis_cache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("primary_access_key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"EXPORTER_PREFIX"')]),t._v("                     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"st:queues"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"EXPORTER_STAT_PREFIX"')]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"bull_queue_"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("The "),a("a",{attrs:{href:"https://github.com/UpHabit/bull_exporter",target:"_blank",rel:"noopener noreferrer"}},[t._v("Bull Prometheus exporter"),a("OutboundLink")],1),t._v(" exposes metrics from the queuing service based on Redis\n"),a("a",{attrs:{href:"https://prometheus.io",target:"_blank",rel:"noopener noreferrer"}},[t._v("Learn more..."),a("OutboundLink")],1)]),t._v(" "),a("div",{staticClass:"language-hcl extra-class"},[a("pre",{pre:!0,attrs:{class:"language-hcl"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Create the Bull Prometheus exporter service")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("resource "),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v('"azurerm_app_service"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"bull_prometheus_exporter"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("name")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("product")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prefix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("resource_group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location_code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("-"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token type variable"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('-bullprometheusexporter-appservice"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("location")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.location\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("resource_group_name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_resource_group.rg.name\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("app_service_plan_id")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" azurerm_app_service_plan.monitoring.id\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tags")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("product")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.product.name,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("environment")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.environment,\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("tier")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"monitoring"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("enabled")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("https_only")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("site_config")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("linux_fx_version")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"DOCKER|uphabit/bull_exporter:latest"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("min_tls_version")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" var.site_config.min_tls_version\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("always_on")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v("app_settings")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"WEBSITES_ENABLE_APP_SERVICE_STORAGE"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"false"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"DOCKER_ENABLE_CI"')]),t._v("                    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"EXPORTER_REDIS_URL"')]),t._v("                  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redis:'),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_redis_cache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hostname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v(":"),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_redis_cache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ssl_port"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v("?db=0&password="),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("azurerm_redis_cache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("primary_access_key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v('"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"EXPORTER_PREFIX"')]),t._v("                     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"st:queues"')]),t._v(",\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"EXPORTER_STAT_PREFIX"')]),t._v("                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"bull_queue_"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])}),[],!1,null,null,null);s.default=r.exports}}]);