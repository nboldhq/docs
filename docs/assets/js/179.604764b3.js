(window.webpackJsonp=window.webpackJsonp||[]).push([[179],{772:function(t,e,s){"use strict";s.r(e);var a=s(36),n=Object(a.a)({},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"üïµÔ∏è‚Äç‚ôÄÔ∏è-monitoring"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#üïµÔ∏è‚Äç‚ôÄÔ∏è-monitoring"}},[t._v("#")]),t._v(" üïµÔ∏è‚Äç‚ôÄÔ∏è Monitoring")]),t._v(" "),s("p",[s("strong",[t._v("TABLE OF CONTENTS")])]),t._v(" "),s("p"),s("div",{staticClass:"table-of-contents"},[s("ul",[s("li",[s("a",{attrs:{href:"#uptime-monitoring"}},[t._v("Uptime monitoring")]),s("ul",[s("li",[s("a",{attrs:{href:"#monika"}},[t._v("Monika")])]),s("li",[s("a",{attrs:{href:"#azure-front-door"}},[t._v("Azure Front Door")])])])]),s("li",[s("a",{attrs:{href:"#logging"}},[t._v("Logging")])]),s("li",[s("a",{attrs:{href:"#application-performance-monitoring-apm"}},[t._v("Application Performance Monitoring (APM)")])]),s("li",[s("a",{attrs:{href:"#collecting-metrics"}},[t._v("Collecting metrics")]),s("ul",[s("li",[s("a",{attrs:{href:"#metrics-collector"}},[t._v("Metrics collector")])]),s("li",[s("a",{attrs:{href:"#collect-application-metrics"}},[t._v("Collect application metrics")])]),s("li",[s("a",{attrs:{href:"#collect-redis-cache-metrics"}},[t._v("Collect Redis cache metrics")])]),s("li",[s("a",{attrs:{href:"#collect-redis-queues-metrics"}},[t._v("Collect Redis queues metrics")])]),s("li",[s("a",{attrs:{href:"#collect-uptime-metrics"}},[t._v("Collect uptime metrics")])])])]),s("li",[s("a",{attrs:{href:"#auditing"}},[t._v("Auditing")])])])]),s("p"),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"uptime-monitoring"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#uptime-monitoring"}},[t._v("#")]),t._v(" Uptime monitoring")]),t._v(" "),s("p",[t._v("To monitor their uptime, each container exposes an HTTP endpoint at "),s("code",[t._v("/monitoring/ping")]),t._v(", that answers to "),s("code",[t._v("HEAD")]),t._v(" and "),s("code",[t._v("GET")]),t._v(" requests with a "),s("code",[t._v("200")]),t._v(" empty response.")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),s("p",[t._v("You can use the "),s("code",[t._v("user-agent")]),t._v(" HTTP header to identify the monitoring service sending the requests.")])]),t._v(" "),s("p",[t._v("As of today, here are the uptime monitors we're supporting:")]),t._v(" "),s("ul",[s("li",[t._v("Monika")]),t._v(" "),s("li",[t._v("Azure Front Door")])]),t._v(" "),s("h3",{attrs:{id:"monika"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#monika"}},[t._v("#")]),t._v(" Monika")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://monika.hyperjump.tech",target:"_blank",rel:"noopener noreferrer"}},[t._v("Monika"),s("OutboundLink")],1),t._v(" is the default option when running your own SalesTim platform using our sample Docker deployment project.")]),t._v(" "),s("p",[t._v("A sample basic configuration file for monitoring the uptime and latency of the application containers would look like this:")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("probes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" api_probe\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" API ping monitoring endpoint\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("description")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Monitors the /monitoring/ping endpoint of the SalesTim api service\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("interval")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("requests")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("method")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" HEAD\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("url")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://salestim_api:3000/monitoring/ping'")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("timeout")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7000")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("alerts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("query")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" response.status "),s("span",{pre:!0,attrs:{class:"token tag"}},[t._v("!=")]),t._v(" 200\n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("message")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"üî• API Service is DOWN. Expected 200 but returned {{ response.status }}."')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("incidentThreshold")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("recoveryThreshold")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" web_probe\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Web ping monitoring endpoint\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("description")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Monitors the /monitoring/ping endpoint of the SalesTim web service\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("interval")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("requests")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("method")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" HEAD\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("url")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://salestim_web:3000/monitoring/ping'")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("timeout")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7000")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("alerts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("query")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" response.status "),s("span",{pre:!0,attrs:{class:"token tag"}},[t._v("!=")]),t._v(" 200\n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("message")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"üî• WEB Service is DOWN. Expected 200 but returned {{ response.status }}."')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("incidentThreshold")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("recoveryThreshold")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" jobs_probe\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" JOBS ping monitoring endpoint\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("description")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Monitors the /monitoring/ping endpoint of the SalesTim jobs service\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("interval")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("requests")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("method")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" HEAD\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("url")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://salestim_jobs:3000/monitoring/ping'")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("timeout")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7000")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("alerts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("query")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" response.status "),s("span",{pre:!0,attrs:{class:"token tag"}},[t._v("!=")]),t._v(" 200\n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("message")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"üî• JOBS Service is DOWN. Expected 200 but returned {{ response.status }}."')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("incidentThreshold")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("recoveryThreshold")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" scheduler_probe\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" SCHEDULER ping monitoring endpoint\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("description")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Monitors the /monitoring/ping endpoint of the SalesTim scheduler service\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("interval")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("requests")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("method")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" HEAD\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("url")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://salestim_scheduler:3000/monitoring/ping'")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("timeout")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7000")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("alerts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("query")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" response.status "),s("span",{pre:!0,attrs:{class:"token tag"}},[t._v("!=")]),t._v(" 200\n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("message")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"üî• SCHEDULER Service is DOWN. Expected 200 but returned {{ response.status }}."')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("incidentThreshold")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("recoveryThreshold")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("notifications")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" webhook_notification\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" webhook\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("data")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("url")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https://YOUR_WEBHOOK_URL'")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" teams_notification\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" teams\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("data")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("url")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https://YOUR_TEAMS_WEBHOOK_URL'")]),t._v("\n")])])]),s("p",[t._v("To tailor this example, you can refer to Monika's "),s("a",{attrs:{href:"https://monika.hyperjump.tech/overview",target:"_blank",rel:"noopener noreferrer"}},[t._v("configuration"),s("OutboundLink")],1),t._v(" documentation.")]),t._v(" "),s("h3",{attrs:{id:"azure-front-door"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#azure-front-door"}},[t._v("#")]),t._v(" Azure Front Door")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://docs.microsoft.com/en-us/azure/frontdoor/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Azure Front Door"),s("OutboundLink")],1),t._v(" comes with health probes that are used to perform load-balancing and achieve failover in case of a container malfunction. Keep in mind that strictly speaking, "),s("strong",[t._v("Azure Front Door is not an uptime monitoring app")]),t._v(".")]),t._v(" "),s("p",[t._v("To see a detailed Azure Front Door configuration, see our "),s("a",{attrs:{href:"../references/azure_resources_reference"}},[t._v("Azure resources reference")]),t._v(" documentation.")]),t._v(" "),s("p",[t._v("You can also refer to the Azure Front Door "),s("a",{attrs:{href:"https://docs.microsoft.com/en-us/azure/frontdoor/front-door-health-probes",target:"_blank",rel:"noopener noreferrer"}},[t._v("Health probes"),s("OutboundLink")],1),t._v(" documentation.")]),t._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[t._v("Warning")]),t._v(" "),s("p",[t._v("Since Azure Front Door has many edge environments globally, health probe volume for your backends can be quite high, ranging from 25 requests every minute to "),s("strong",[t._v("as high as 1200 requests per minute")]),t._v(", depending on the configured probe frequency.")]),t._v(" "),s("p",[t._v("For instance, with the default probe frequency of 30 seconds, the requests volume on your backend would be about "),s("strong",[t._v("200 requests per minute")]),t._v(".")])]),t._v(" "),s("h2",{attrs:{id:"logging"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#logging"}},[t._v("#")]),t._v(" Logging")]),t._v(" "),s("p",[t._v("Our platform comes with a configurable logging module that generates logs as configured by the "),s("RouterLink",{attrs:{to:"/hosting/references/configuration_reference.html#logging"}},[t._v("Logging configuration")]),t._v(".")],1),t._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[t._v("Persisting log files")]),t._v(" "),s("p",[t._v("Log files persistence is not enabled by default and we recommend to use an external log ingestion solution in production environments.")])]),t._v(" "),s("p",[t._v("As SalesTim comes with a native connector for Microsoft Application Insights, the easiest and recommended way to collect and centralize all the logs and traces, is to enable and configure the connector from the "),s("RouterLink",{attrs:{to:"/hosting/references/configuration_reference.html#microsoft-application-insights"}},[t._v("Application Insights configuration")]),t._v(".")],1),t._v(" "),s("p",[t._v("Application Insights is part of the "),s("a",{attrs:{href:"https://docs.microsoft.com/en-us/azure/azure-monitor/overview",target:"_blank",rel:"noopener noreferrer"}},[t._v("Azure Monitor"),s("OutboundLink")],1),t._v(" service and uses an Azure Log Analytics Workspace under the hood as a storage. From Application Insights, you can live-monitor the whole SalesTim platform, investigate issues using traces and events, detect performance bottlenecks... Learn more about "),s("a",{attrs:{href:"https://docs.microsoft.com/en-us/azure/azure-monitor/app/app-insights-overview",target:"_blank",rel:"noopener noreferrer"}},[t._v("Microsoft Application Insights"),s("OutboundLink")],1),t._v(".")]),t._v(" "),s("h2",{attrs:{id:"application-performance-monitoring-apm"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#application-performance-monitoring-apm"}},[t._v("#")]),t._v(" Application Performance Monitoring (APM)")]),t._v(" "),s("p",[t._v("As SalesTim comes with a native connector for Microsoft Application Insights, the easiest and recommended way to collect and centralize APM metrics, is to enable and configure the connector from the "),s("RouterLink",{attrs:{to:"/hosting/references/configuration_reference.html#microsoft-application-insights"}},[t._v("Application Insights configuration")]),t._v(".")],1),t._v(" "),s("p",[t._v("Application Insights is part of the "),s("a",{attrs:{href:"https://docs.microsoft.com/en-us/azure/azure-monitor/overview",target:"_blank",rel:"noopener noreferrer"}},[t._v("Azure Monitor"),s("OutboundLink")],1),t._v(" service and uses an Azure Log Analytics Workspace under the hood as a storage. From Application Insights, you can live-monitor the whole SalesTim platform, investigate issues using traces and events, detect performance bottlenecks... Learn more about "),s("a",{attrs:{href:"https://docs.microsoft.com/en-us/azure/azure-monitor/app/app-insights-overview",target:"_blank",rel:"noopener noreferrer"}},[t._v("Microsoft Application Insights"),s("OutboundLink")],1),t._v(".")]),t._v(" "),s("h2",{attrs:{id:"collecting-metrics"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#collecting-metrics"}},[t._v("#")]),t._v(" Collecting metrics")]),t._v(" "),s("h3",{attrs:{id:"metrics-collector"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#metrics-collector"}},[t._v("#")]),t._v(" Metrics collector")]),t._v(" "),s("p",[t._v("The SalesTim platform relies on "),s("a",{attrs:{href:"https://prometheus.io/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Prometheus"),s("OutboundLink")],1),t._v(" to collect and centralize all its metrics.")]),t._v(" "),s("p",[t._v("Prometheus is an open-source software application that is used for event monitoring. It collects metrics such as requests count, duration and exceptions from applications and records them in a time-series database. Prometheus is also used for monitoring CPU status and memory/disk-space usage so it can be used and be represented in a meaningful display.")]),t._v(" "),s("p",[t._v("Prometheus has become widely known and used in software industries due to its open-source and ease of use. Prometheus is a stand alone and self containing application that run by pulling data from services using worker systems that runs periodically.")]),t._v(" "),s("h3",{attrs:{id:"collect-application-metrics"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#collect-application-metrics"}},[t._v("#")]),t._v(" Collect application metrics")]),t._v(" "),s("p",[t._v("To expose their metrics, each SalesTIm container exposes an HTTP endpoint at "),s("code",[t._v("/monitoring/metrics")]),t._v(", that answers to "),s("code",[t._v("GET")]),t._v(" requests with a "),s("code",[t._v("200")]),t._v(" response, using the "),s("a",{attrs:{href:"https://prometheus.io/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Prometheus"),s("OutboundLink")],1),t._v(" exporter format.")]),t._v(" "),s("p",[t._v("Exported metrics could be configured from the "),s("RouterLink",{attrs:{to:"/references/configuration_reference.html#prometheus"}},[t._v("Prometheus Configuration")]),t._v(" options.")],1),t._v(" "),s("p",[s("strong",[t._v("Metrics exposed:")])]),t._v(" "),s("ul",[s("li",[t._v("Default metrics from "),s("a",{attrs:{href:"https://github.com/siimon/prom-client",target:"_blank",rel:"noopener noreferrer"}},[t._v("prom-client"),s("OutboundLink")],1),t._v(".")]),t._v(" "),s("li",[s("code",[t._v("http_requests_total")]),t._v(": Counter for total requests received, has labels "),s("code",[t._v("route")]),t._v(", "),s("code",[t._v("method")]),t._v(", "),s("code",[t._v("status")])]),t._v(" "),s("li",[s("code",[t._v("http_request_duration_seconds")]),t._v(": - Duration of HTTP requests in seconds, has labels "),s("code",[t._v("route")]),t._v(", "),s("code",[t._v("method")]),t._v(", "),s("code",[t._v("status")])])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("Notes")]),t._v(" "),s("ol",[s("li",[t._v("Standard nodejs exposed metrics are prefixed by "),s("code",[t._v("st_")])]),t._v(" "),s("li",[t._v("The labels "),s("code",[t._v("route")]),t._v(" and "),s("code",[t._v("status")]),t._v(" are normalized:")])]),t._v(" "),s("ul",[s("li",[s("code",[t._v("route")]),t._v(": will normalize id like route params")]),t._v(" "),s("li",[s("code",[t._v("status")]),t._v(": will normalize to status code family groups, like "),s("code",[t._v("2XX")]),t._v(" or "),s("code",[t._v("4XX")]),t._v(".")])])]),t._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[t._v("How to secure the metrics endpoint?")]),t._v(" "),s("p",[t._v("In production, you can secure the "),s("code",[t._v("/monitoring/metrics")]),t._v(" endpoint to prevent any technical information leak. To do so, define the "),s("code",[t._v("PROMETHEUS_EXPORTER_AUTH_TOKEN")]),t._v(" property from the "),s("RouterLink",{attrs:{to:"/references/configuration_reference.html#prometheus"}},[t._v("Prometheus Configuration")]),t._v(" options.")],1)]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# The rand command encodes the produced random bytes in base64. This encoding converts bytes to alphanumeric characters, including the characters `=`, `+`, and `/`. These characters are filtered to have passwords without special characters and prevent url encoding issues. It reduces the random character of the token a little bit, but is not a concern when the token is more than 10 characters.")]),t._v("\nopenssl rand -base64 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("29")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("tr")]),t._v(" -d "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"=+/"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cut")]),t._v(" -c1-25\n")])])]),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# The rand command encodes the produced random bytes in base64. This encoding converts bytes to alphanumeric characters, including the characters `=`, `+`, and `/`. These characters are filtered to have passwords without special characters and prevent url encoding issues. It reduces the random character of the token a little bit, but is not a concern when the token is more than 10 characters.")]),t._v("\nopenssl rand -base64 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("29")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("tr")]),t._v(" -d "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"=+/"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cut")]),t._v(" -c1-25\n")])])]),s("p",[t._v("A convenient way to generate a secure token is to use the "),s("code",[t._v("openssl")]),t._v(" command, such as:")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# The rand command encodes the produced random bytes in base64. This encoding converts bytes to alphanumeric characters, including the characters `=`, `+`, and `/`. These characters are filtered to have passwords without special characters and prevent url encoding issues. It reduces the random character of the token a little bit, but is not a concern when the token is more than 10 characters.")]),t._v("\nopenssl rand -base64 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("29")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("tr")]),t._v(" -d "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"=+/"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cut")]),t._v(" -c1-25\n")])])])]),t._v(" "),s("h3",{attrs:{id:"collect-redis-cache-metrics"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#collect-redis-cache-metrics"}},[t._v("#")]),t._v(" Collect Redis cache metrics")]),t._v(" "),s("p",[t._v("Redis metrics can be exported by using a "),s("a",{attrs:{href:"https://github.com/oliver006/redis_exporter",target:"_blank",rel:"noopener noreferrer"}},[t._v("Redis Prometheus exporter"),s("OutboundLink")],1),t._v(" container.\nMost items from the "),s("code",[t._v("INFO")]),t._v(" command are exported, see "),s("a",{attrs:{href:"https://redis.io/commands/info",target:"_blank",rel:"noopener noreferrer"}},[t._v("Redis INFO command documentation"),s("OutboundLink")],1),t._v(" for details.")]),t._v(" "),s("h3",{attrs:{id:"collect-redis-queues-metrics"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#collect-redis-queues-metrics"}},[t._v("#")]),t._v(" Collect Redis queues metrics")]),t._v(" "),s("p",[t._v("SalesTim uses the "),s("a",{attrs:{href:"https://github.com/OptimalBits/bull",target:"_blank",rel:"noopener noreferrer"}},[t._v("Bull"),s("OutboundLink")],1),t._v(" module to manage its asynchronous jobs. Bull is a Queue package for handling distributed jobs and messages in NodeJS.")]),t._v(" "),s("p",[t._v("To monitor Bull queues, you can use a "),s("a",{attrs:{href:"https://github.com/UpHabit/bull_exporter",target:"_blank",rel:"noopener noreferrer"}},[t._v("Bull Prometheus exporter"),s("OutboundLink")],1),t._v(" container.\nMost items from the "),s("code",[t._v("INFO")]),t._v(" command are exported, see "),s("a",{attrs:{href:"https://redis.io/commands/info",target:"_blank",rel:"noopener noreferrer"}},[t._v("Redis INFO command documentation"),s("OutboundLink")],1),t._v(" for details.")]),t._v(" "),s("p",[s("strong",[t._v("Metrics exposed:")])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("Metric")]),t._v(" "),s("th",[t._v("type")]),t._v(" "),s("th",[t._v("description")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("code",[t._v("bull_queue_completed")])]),t._v(" "),s("td",[t._v("counter")]),t._v(" "),s("td",[t._v("Total number of completed jobs")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("bull_queue_complete_duration")])]),t._v(" "),s("td",[t._v("summary")]),t._v(" "),s("td",[t._v("Processing time for completed jobs")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("bull_queue_active")])]),t._v(" "),s("td",[t._v("counter")]),t._v(" "),s("td",[t._v("Total number of active jobs (currently being processed)")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("bull_queue_delayed")])]),t._v(" "),s("td",[t._v("counter")]),t._v(" "),s("td",[t._v("Total number of jobs that will run in the future")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("bull_queue_failed")])]),t._v(" "),s("td",[t._v("counter")]),t._v(" "),s("td",[t._v("Total number of failed jobs")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("bull_queue_waiting")])]),t._v(" "),s("td",[t._v("counter")]),t._v(" "),s("td",[t._v("Total number of jobs waiting to be processed")])])])]),t._v(" "),s("h3",{attrs:{id:"collect-uptime-metrics"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#collect-uptime-metrics"}},[t._v("#")]),t._v(" Collect uptime metrics")]),t._v(" "),s("p",[t._v("If you're using Monika to monitor your platform uptime, you can customize its container configuration to make it expose some useful metrics.")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Run Monika in the background and expose its Prometheus metrics to the 3010 port.")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("command")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"monika"')]),t._v(", "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-c"')]),t._v(", "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/config/monika.yml"')]),t._v(", "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--prometheus"')]),t._v(", "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3010"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Run Monika in the background and expose its Prometheus metrics to the 3010 port.")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("command")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"monika"')]),t._v(", "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-c"')]),t._v(", "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/config/monika.yml"')]),t._v(", "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--prometheus"')]),t._v(", "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3010"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("p",[t._v("To do so, you must customize Monika's container startup command to use the "),s("code",[t._v("--prometheus")]),t._v(", such as:")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Run Monika in the background and expose its Prometheus metrics to the 3010 port.")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("command")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"monika"')]),t._v(", "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-c"')]),t._v(", "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/config/monika.yml"')]),t._v(", "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--prometheus"')]),t._v(", "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3010"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("p",[t._v("Of course, you can also use this technique to expose metrics from any Prometheus-compatible uptime monitoring solution.")]),t._v(" "),s("p",[s("strong",[t._v("Metrics exposed:")])]),t._v(" "),s("ul",[s("li",[t._v("Default metrics from "),s("a",{attrs:{href:"https://github.com/siimon/prom-client",target:"_blank",rel:"noopener noreferrer"}},[t._v("prom-client"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("code",[t._v("monika_request_status_code_info")]),t._v(": (gauge) HTTP status code")]),t._v(" "),s("li",[s("code",[t._v("monika_request_response_time_seconds")]),t._v(": (histogram) Duration of probe request in seconds")]),t._v(" "),s("li",[s("code",[t._v("monika_request_response_size_bytes")]),t._v(": (gauge) Size of response size in bytes")]),t._v(" "),s("li",[s("code",[t._v("monika_probes_total")]),t._v(": (gauge) Total of all probe")])]),t._v(" "),s("h2",{attrs:{id:"auditing"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#auditing"}},[t._v("#")]),t._v(" Auditing")]),t._v(" "),s("p",[t._v("To see the list au audited events, you can refer to the "),s("a",{attrs:{href:"../references/events_reference"}},[t._v("Events reference")]),t._v(" documentation, and look for events with the "),s("code",[t._v("Tracking")]),t._v(" configuration:")]),t._v(" "),s("ul",[s("li",[t._v("Enabled: "),s("code",[t._v("true")])]),t._v(" "),s("li",[t._v("Audit trail: "),s("code",[t._v("true")])])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("Exporting audit trails from the audit database")]),t._v(" "),s("p",[t._v("Our "),s("a",{attrs:{href:"../references/events_reference"}},[t._v("Events reference")]),t._v(" documentation also specifies the mapping between an audited event and its representation in the audit database:")]),t._v(" "),s("ul",[s("li",[t._v("Table: Tracking "),s("code",[t._v("Code")])]),t._v(" "),s("li",[t._v("Columns: Tracking "),s("code",[t._v("Audited fields")])])])])])}),[],!1,null,null,null);e.default=n.exports}}]);